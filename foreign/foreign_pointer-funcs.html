<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>4&nbsp;Pointer Functions</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Racket Foreign Interface</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Loading_Foreign_Libraries.html" class="tocviewlink" data-pltdoc="x">Loading Foreign Libraries</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="types.html" class="tocviewlink" data-pltdoc="x">C Types</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Pointer Functions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Derived_Utilities.html" class="tocviewlink" data-pltdoc="x">Derived Utilities</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Miscellaneous_Support.html" class="tocviewlink" data-pltdoc="x">Miscellaneous Support</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="foreign_c-only.html" class="tocviewlink" data-pltdoc="x">Unexported Primitive Functions</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Pointer Functions</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">4.1&nbsp;</td><td><a href="#%28part._.Pointer_.Dereferencing%29" class="tocviewlink" data-pltdoc="x">Pointer Dereferencing</a></td></tr><tr><td align="right">4.2&nbsp;</td><td><a href="#%28part._.Memory_.Management%29" class="tocviewlink" data-pltdoc="x">Memory Management</a></td></tr><tr><td align="right">4.3&nbsp;</td><td><a href="#%28part._.Pointer_.Structure_.Property%29" class="tocviewlink" data-pltdoc="x">Pointer Structure Property</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">在本页中：</div><table class="tocsublist" cellspacing="0"><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">cpointer?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-equal~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">ptr-<wbr></wbr>equal?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-add%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">ptr-<wbr></wbr>add</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._offset-ptr~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">offset-<wbr></wbr>ptr?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-offset%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">ptr-<wbr></wbr>offset</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer-gcable~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">cpointer-<wbr></wbr>gcable?</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.Pointer_.Dereferencing%29" class="tocsubseclink" data-pltdoc="x">Pointer Dereferencing</a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._set-ptr-offset%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">set-<wbr></wbr>ptr-<wbr></wbr>offset!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-add%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">ptr-<wbr></wbr>add!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-ref%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">ptr-<wbr></wbr>ref</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-set%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">ptr-<wbr></wbr>set!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._memmove%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">memmove</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._memcpy%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">memcpy</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._memset%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">memset</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer-tag%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">cpointer-<wbr></wbr>tag</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._set-cpointer-tag%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">set-<wbr></wbr>cpointer-<wbr></wbr>tag!</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._.Memory_.Management%29" class="tocsubseclink" data-pltdoc="x">Memory Management</a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._malloc%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">malloc</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._free%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">free</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._end-stubborn-change%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">end-<wbr></wbr>stubborn-<wbr></wbr>change</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._malloc-immobile-cell%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">malloc-<wbr></wbr>immobile-<wbr></wbr>cell</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._free-immobile-cell%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">free-<wbr></wbr>immobile-<wbr></wbr>cell</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._register-finalizer%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">register-<wbr></wbr>finalizer</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._make-late-weak-box%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>late-<wbr></wbr>weak-<wbr></wbr>box</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._make-late-weak-hasheq%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>late-<wbr></wbr>weak-<wbr></wbr>hasheq</span></span></a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._make-sized-byte-string%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>sized-<wbr></wbr>byte-<wbr></wbr>string</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._void%2Freference-sink%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">void/<span class="mywbr"> &nbsp;</span>reference-<wbr></wbr>sink</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.3<tt>&nbsp;</tt></span><a href="#%28part._.Pointer_.Structure_.Property%29" class="tocsubseclink" data-pltdoc="x">Pointer Structure Property</a></td></tr><tr><td><a href="#%28def._%28%28quote._~23~25foreign%29._prop~3acpointer%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">prop:<span class="mywbr"> &nbsp;</span>cpointer</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="Enumerations_and_Masks.html" title="后退至&quot;3.10 Enumerations and Masks&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="index.html" title="上至&quot;The Racket Foreign Interface&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="Derived_Utilities.html" title="前进至&quot;5 Derived Utilities&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;scribblings/foreign/foreign.scrbl&quot;)" x-source-pkg="racket-doc" x-part-tag="&quot;foreign:pointer-funcs&quot;">4<tt>&nbsp;</tt><a name="(part._foreign~3apointer-funcs)"></a>Pointer Functions</h3><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._cpointer~3f))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">cpointer?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> is a C pointer or a value that can
be used as a pointer: <span class="RktVal">#f</span> (used as a <span class="stt">NULL</span> pointer), byte
strings (used as memory blocks), or a structure instance with the
<span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._prop~3acpointer%29%29" class="RktValLink" data-pltdoc="x">prop:cpointer</a></span> <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=structprops.html%23%2528tech._structure._type._property%2529&amp;version=7.0.0.18" class="techoutside Sq" data-pltdoc="x"><span class="techinside">structure type
property</span></a>.  Returns <span class="RktVal">#f</span> for other values.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._ptr-equal~3f))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-equal~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">ptr-equal?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr1</span><span class="hspace">&nbsp;</span><span class="RktVar">cptr2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr1</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr2</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Compares the values of the two pointers. Two different Racket
pointer objects can contain the same pointer.</div></p><p>If the values are both pointers that are not represented by
<span class="RktVal">#f</span>, a byte string, a callback, a pointer based on
<span class="RktSym"><a href="Pointer_Types.html#%28def._%28%28quote._~23~25foreign%29.__fpointer%29%29" class="RktValLink" data-pltdoc="x">_fpointer</a></span>, or a structure with the <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._prop~3acpointer%29%29" class="RktValLink" data-pltdoc="x">prop:cpointer</a></span>
property, then the <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-equal~3f%29%29" class="RktValLink" data-pltdoc="x">ptr-equal?</a></span> comparison is the
same as using <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._equal%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">equal?</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._ptr-add))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-add%29%29" class="RktValDef RktValLink" data-pltdoc="x">ptr-add</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>[<span class="RktVar">type</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a cpointer that is like <span class="RktVar">cptr</span> offset by
<span class="RktVar">offset</span> instances of <span class="RktSym">ctype</span>.</div></p><p>The resulting cpointer keeps the base pointer and offset separate. The
two pieces are combined at the last minute before any operation on the
pointer, such as supplying the pointer to a foreign function. In
particular, the pointer and offset are not combined until after all
allocation leading up to a foreign-function call; if the called
function does not itself call anything that can trigger a garbage
collection, it can safely use pointers that are offset into the middle
of a GCable object.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._offset-ptr~3f))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._offset-ptr~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">offset-ptr?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A predicate for cpointers that have an offset, such as pointers that
were created using <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-add%29%29" class="RktValLink" data-pltdoc="x">ptr-add</a></span>.  Returns <span class="RktVal">#t</span> even if such
an offset happens to be 0.  Returns <span class="RktVal">#f</span> for other cpointers
and non-cpointers.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._ptr-offset))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-offset%29%29" class="RktValDef RktValLink" data-pltdoc="x">ptr-offset</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the offset of a pointer that has an offset. The resulting
offset is always in bytes.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._cpointer-gcable~3f))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer-gcable~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">cpointer-gcable?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">cptr</span> is treated as a reference to
memory that is managed by the garbage collector, <span class="RktVal">#f</span>
otherwise.</div></p><h4 x-source-module="(lib &quot;scribblings/foreign/foreign.scrbl&quot;)" x-source-pkg="racket-doc" x-part-tag="&quot;Pointer_Dereferencing&quot;">4.1<tt>&nbsp;</tt><a name="(part._.Pointer_.Dereferencing)"></a>Pointer Dereferencing</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._set-ptr-offset!))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._set-ptr-offset%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">set-ptr-offset!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>[<span class="RktVar">ctype</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ctype</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Sets the offset component of an offset pointer.  The arguments are
used in the same way as <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-add%29%29" class="RktValLink" data-pltdoc="x">ptr-add</a></span>.  If <span class="RktVar">cptr</span> has no
offset, the <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._exn%7E3afail%7E3acontract%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exn:fail:contract</a></span> exception is raised.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._ptr-add!))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-add%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">ptr-add!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>[<span class="RktVar">ctype</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ctype</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-add%29%29" class="RktValLink" data-pltdoc="x">ptr-add</a></span>, but destructively modifies the offset contained
in a pointer.  The same operation could be performed using
<span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-offset%29%29" class="RktValLink" data-pltdoc="x">ptr-offset</a></span> and <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._set-ptr-offset%21%29%29" class="RktValLink" data-pltdoc="x">set-ptr-offset!</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._ptr-ref))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-ref%29%29" class="RktValDef RktValLink" data-pltdoc="x">ptr-ref</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>[<span class="RktVar">offset</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">any</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="RktPn">(</span><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-ref%29%29" class="RktValDef RktValLink" data-pltdoc="x">ptr-ref</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span><span class="RktVar">abs-tag</span><span class="hspace">&nbsp;</span><span class="RktVar">offset</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">any</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">abs-tag</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._one-of%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">one-of/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">abs</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._ptr-set!))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-set%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">ptr-set!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="RktPn">(</span><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-set%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">ptr-set!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="RktPn">(</span><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-set%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">ptr-set!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span><span class="RktVar">abs-tag</span><span class="hspace">&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">abs-tag</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._one-of%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">one-of/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">abs</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">The <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-ref%29%29" class="RktValLink" data-pltdoc="x">ptr-ref</a></span> procedure returns the object referenced by
<span class="RktVar">cptr</span>, using the given <span class="RktVar">type</span>. The <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-set%21%29%29" class="RktValLink" data-pltdoc="x">ptr-set!</a></span>
procedure stores the <span class="RktVar">val</span> in the memory <span class="RktVar">cptr</span> points
to, using the given <span class="RktVar">type</span> for the conversion.</div></p><p>In each case, <span class="RktVar">offset</span> defaults to <span class="RktVal">0</span> (which is the
only value that should be used with <span class="RktSym">ffi-obj</span> objects, see
<a href="foreign_c-only.html" data-pltdoc="x">Unexported Primitive Functions</a>).  If an <span class="RktVar">offset</span> index is
non-<span class="RktVal">0</span>, the value is read or stored at that location,
considering the pointer as a vector of <span class="RktVar">type</span>s &#8212;<wbr></wbr> so the
actual address is the pointer plus the size of <span class="RktVar">type</span>
multiplied by <span class="RktVar">offset</span>.  In addition, a <span class="RktVal">'</span><span class="RktVal">abs</span> flag can
be used to use the <span class="RktVar">offset</span> as counting bytes rather then
increments of the specified <span class="RktVar">type</span>.</p><p>Beware that the <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-ref%29%29" class="RktValLink" data-pltdoc="x">ptr-ref</a></span> and <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-set%21%29%29" class="RktValLink" data-pltdoc="x">ptr-set!</a></span> procedure do
not keep any meta-information on how pointers are used.  It is the
programmer&rsquo;s responsibility to use this facility only when
appropriate.  For example, on a little-endian machine:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3e%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">block</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._malloc%29%29" class="RktValLink" data-pltdoc="x">malloc</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3e%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-set%21%29%29" class="RktValLink" data-pltdoc="x">ptr-set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">block</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">196353</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3e%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmap..rkt%2529._map%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-ref%29%29" class="RktValLink" data-pltdoc="x">ptr-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">block</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktRes">(1 255 2 0)</span></td></tr></table></blockquote><p>In addition, <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-ref%29%29" class="RktValLink" data-pltdoc="x">ptr-ref</a></span> and <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-set%21%29%29" class="RktValLink" data-pltdoc="x">ptr-set!</a></span> cannot detect when
offsets are beyond an object&rsquo;s memory bounds; out-of-bounds access can
easily lead to a segmentation fault or memory corruption.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._memmove))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._memmove%29%29" class="RktValDef RktValLink" data-pltdoc="x">memmove</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">cptr</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span>[</td><td valign="top"><span class="RktVar">offset</span>]</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">src-cptr</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span>[</td><td valign="top"><span class="RktVar">src-offset</span>]</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">count</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span>[</td><td valign="top"><span class="RktVar">type</span>]<span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">src-cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">src-offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">count</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Copies to <span class="RktVar">cptr</span> from <span class="RktVar">src-cptr</span>. The destination
pointer can be offset by an optional <span class="RktVar">offset</span>, which is in
<span class="RktVar">type</span> instances.  The source pointer can be similarly offset
by <span class="RktVar">src-offset</span>.  The number of bytes copied from source to
destination is determined by <span class="RktVar">count</span>, which is in <span class="RktVar">type</span>
instances when supplied.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._memcpy))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._memcpy%29%29" class="RktValDef RktValLink" data-pltdoc="x">memcpy</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">cptr</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span>[</td><td valign="top"><span class="RktVar">offset</span>]</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">src-cptr</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span>[</td><td valign="top"><span class="RktVar">src-offset</span>]</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">count</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span>[</td><td valign="top"><span class="RktVar">type</span>]<span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">src-cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">src-offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">count</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._memmove%29%29" class="RktValLink" data-pltdoc="x">memmove</a></span>, but the result is undefined if the destination
and source overlap.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._memset))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._memset%29%29" class="RktValDef RktValLink" data-pltdoc="x">memset</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>[<span class="RktVar">offset</span>]<span class="hspace">&nbsp;</span><span class="RktVar">byte</span><span class="hspace">&nbsp;</span><span class="RktVar">count</span><span class="hspace">&nbsp;</span>[<span class="RktVar">type</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">offset</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">byte</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._byte%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">byte?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">count</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._memmove%29%29" class="RktValLink" data-pltdoc="x">memmove</a></span>, but the destination is uniformly filled
with <span class="RktVar">byte</span> (i.e., an exact integer between 0 and 255
inclusive). When a <span class="RktVar">type</span> argument is present, the result
is that of a call to memset with no <span class="RktVar">type</span> argument and the
<span class="RktVar">count</span> multiplied by the size associated with the
<span class="RktVar">type</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._cpointer-tag))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer-tag%29%29" class="RktValDef RktValLink" data-pltdoc="x">cpointer-tag</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">any</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the Racket object that is the tag of the given <span class="RktVar">cptr</span>
pointer.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._set-cpointer-tag!))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._set-cpointer-tag%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">set-cpointer-tag!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span><span class="RktVar">tag</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">tag</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Sets the tag of the given <span class="RktVar">cptr</span>. The <span class="RktVar">tag</span> argument can
be any arbitrary value; other pointer operations ignore it.  When a
cpointer value is printed, its tag is shown if it is a symbol, a byte
string, a string. In addition, if the tag is a pair holding one of
these in its <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">car</a></span>, the <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">car</a></span> is shown (so that the tag
can contain other information).</div></p><h4 x-source-module="(lib &quot;scribblings/foreign/foreign.scrbl&quot;)" x-source-pkg="racket-doc" x-part-tag="&quot;Memory_Management&quot;">4.2<tt>&nbsp;</tt><a name="(part._.Memory_.Management)"></a>Memory Management</h4><p>For general information on C-level memory management with Racket,
see <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=index.html&amp;version=7.0.0.18" class="Sq" data-pltdoc="x">Inside: Racket C API</a>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._malloc))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._malloc%29%29" class="RktValDef RktValLink" data-pltdoc="x">malloc</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">bytes-or-type</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span>[</td><td valign="top"><span class="RktVar">type-or-bytes</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">cptr</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mode</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">fail-mode</span>]<span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr></table></blockquote></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td valign="top"><span class="hspace">&nbsp;&nbsp;</span></td><td valign="top"><span class="RktVar">bytes-or-type</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">:</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._and%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">and/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._fixnum%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">fixnum?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td valign="top"><span class="hspace">&nbsp;&nbsp;</span></td><td valign="top"><span class="RktVar">type-or-bytes</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">:</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._and%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">and/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._fixnum%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">fixnum?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">=</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">absent</td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span>absent</td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td valign="top"><span class="hspace">&nbsp;&nbsp;</span></td><td valign="top"><span class="RktVar">mode</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">:</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._one-of%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">one-of/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">raw</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">atomic</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">nonatomic</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">tagged</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">atomic-interior</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">interior</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">stubborn</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">uncollectable</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">eternal</span><span class="RktPn">)</span></td></tr></table></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">=</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">absent</td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">fail-mode</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._one-of%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">one-of/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">failok</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span>absent</td></tr></table></blockquote></div><div class="SIntrapara">Allocates a memory block of a specified size using a specified
allocation. The result is a <span class="RktSym">cpointer</span> to the allocated
memory, or <span class="RktVal">#f</span> if the requested size is zero.  Although
not reflected above, the four arguments can appear in
any order, since they are all different types of Racket objects; a size
specification is required at minimum:</div></p><ul><li><p>If a C type <span class="RktVar">bytes-or-type</span> is given, its size is used
to the block allocation size.</p></li><li><p>If an integer <span class="RktVar">bytes-or-type</span> is given, it specifies the
required size in bytes.</p></li><li><p>If both <span class="RktVar">bytes-or-type</span> and <span class="RktVar">type-or-bytes</span> are given,
then the allocated size is for a vector of values (the multiplication of
the size of the C type and the integer).</p></li><li><p>If a <span class="RktVar">cptr</span> pointer is given, its content is copied to
the new block.</p></li><li><p>A symbol <span class="RktVar">mode</span> argument can be given, which specifies
what allocation function to use.  It should be one of
<a name="(idx._(gentag._6._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">nonatomic</span> (uses <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=im_memoryalloc.html%23%2528cpp._scheme_malloc%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_malloc</span></a> from
Racket&rsquo;s C API), <a name="(idx._(gentag._7._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">atomic</span>
(<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=im_memoryalloc.html%23%2528cpp._scheme_malloc_atomic%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_malloc_atomic</span></a>), <a name="(idx._(gentag._8._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">tagged</span>
(<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=im_memoryalloc.html%23%2528cpp._scheme_malloc_tagged%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_malloc_tagged</span></a>), <a name="(idx._(gentag._9._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">stubborn</span>
(<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=im_memoryalloc.html%23%2528cpp._scheme_malloc_stubborn%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_malloc_stubborn</span></a>), <a name="(idx._(gentag._10._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">uncollectable</span>
(<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=im_memoryalloc.html%23%2528cpp._scheme_malloc_uncollectable%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_malloc_uncollectable</span></a>), <a name="(idx._(gentag._11._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">eternal</span>
(<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=im_memoryalloc.html%23%2528cpp._scheme_malloc_eternal%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_malloc_eternal</span></a>), <a name="(idx._(gentag._12._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">interior</span>
(<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=im_memoryalloc.html%23%2528cpp._scheme_malloc_allow_interior%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_malloc_allow_interior</span></a>),
<a name="(idx._(gentag._13._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">atomic-interior</span>
(<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=im_memoryalloc.html%23%2528cpp._scheme_malloc_atomic_allow_interior%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_malloc_atomic_allow_interior</span></a>), or
<a name="(idx._(gentag._14._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">raw</span> (uses the operating system&rsquo;s <span class="stt">malloc</span>,
creating a GC-invisible block).</p></li><li><p>If an additional
<a name="(idx._(gentag._15._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="RktVal">'</span><span class="RktVal">failok</span> flag is given, then
<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=im_memoryalloc.html%23%2528cpp._scheme_malloc_fail_ok%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_malloc_fail_ok</span></a> is used to wrap the call.</p></li></ul><p>If no mode is specified, then <span class="RktVal">'</span><span class="RktVal">nonatomic</span> allocation is used
when the type is a <span class="RktSym"><a href="Pointer_Types.html#%28def._%28%28quote._~23~25foreign%29.__gcpointer%29%29" class="RktValLink" data-pltdoc="x">_gcpointer</a></span>- or <span class="RktSym"><a href="Pointer_Types.html#%28def._%28%28quote._~23~25foreign%29.__scheme%29%29" class="RktValLink" data-pltdoc="x">_scheme</a></span>-based
type, and <span class="RktVal">'</span><span class="RktVal">atomic</span> allocation is used otherwise.</p><p class="SHistory">&#20462;&#25913;&#20110;package <span class="stt">base</span>&#30340;6.4.0.10&#29256;&#26412;&#65306;Added the <span class="RktVal">'</span><span class="RktVal">tagged</span> allocation mode.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._free))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._free%29%29" class="RktValDef RktValLink" data-pltdoc="x">free</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Uses the operating system&rsquo;s <span class="stt">free</span> function for
<span class="RktVal">'</span><span class="RktVal">raw</span>-allocated pointers, and for pointers that a foreign
library allocated and we should free.  Note that this is useful as
part of a finalizer (see below) procedure hook (e.g., on the Racket
pointer object, freeing the memory when the pointer object is
collected, but beware of aliasing).</div></p><p>Memory allocated with <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._malloc%29%29" class="RktValLink" data-pltdoc="x">malloc</a></span> and modes other than
<span class="RktVal">'</span><span class="RktVal">raw</span> must not be <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._free%29%29" class="RktValLink" data-pltdoc="x">free</a></span>d, since those modes allocate
memory that is managed by the garbage collector.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._end-stubborn-change))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._end-stubborn-change%29%29" class="RktValDef RktValLink" data-pltdoc="x">end-stubborn-change</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Uses <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=im_memoryalloc.html%23%2528cpp._scheme_end_stubborn_change%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_end_stubborn_change</span></a> on the given stubborn-allocated
pointer.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._malloc-immobile-cell))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._malloc-immobile-cell%29%29" class="RktValDef RktValLink" data-pltdoc="x">malloc-immobile-cell</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Allocates memory large enough to hold one arbitrary (collectable)
Racket value, but that is not itself collectable or moved by the
memory manager. The cell is initialized with <span class="RktVar">v</span>; use the type
<span class="RktSym"><a href="Pointer_Types.html#%28def._%28%28quote._~23~25foreign%29.__scheme%29%29" class="RktValLink" data-pltdoc="x">_scheme</a></span> with <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-ref%29%29" class="RktValLink" data-pltdoc="x">ptr-ref</a></span> and <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-set%21%29%29" class="RktValLink" data-pltdoc="x">ptr-set!</a></span> to get
or set the cell&rsquo;s value. The cell must be explicitly freed with
<span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._free-immobile-cell%29%29" class="RktValLink" data-pltdoc="x">free-immobile-cell</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._free-immobile-cell))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._free-immobile-cell%29%29" class="RktValDef RktValLink" data-pltdoc="x">free-immobile-cell</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Frees an immobile cell created by <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._malloc-immobile-cell%29%29" class="RktValLink" data-pltdoc="x">malloc-immobile-cell</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe..rkt)._register-finalizer))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._register-finalizer%29%29" class="RktValDef RktValLink" data-pltdoc="x">register-finalizer</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">obj</span><span class="hspace">&nbsp;</span><span class="RktVar">finalizer</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">obj</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">finalizer</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Registers a finalizer procedure <span class="RktSym">finalizer-proc</span> with the given
<span class="RktVar">obj</span>, which can be any Racket (GC-able) object. The finalizer
is registered with a &ldquo;late&rdquo; <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=willexecutor.html%23%2528tech._will._executor%2529&amp;version=7.0.0.18" class="techoutside Sq" data-pltdoc="x"><span class="techinside">will
executor</span></a> that makes wills ready for a value only after all
<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=weakbox.html%23%2528tech._weak._box%2529&amp;version=7.0.0.18" class="techoutside Sq" data-pltdoc="x"><span class="techinside">weak box</span></a>es referencing the value have
been cleared, which implies that the value is unreachable and no
normal <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=willexecutor.html%23%2528tech._will._executor%2529&amp;version=7.0.0.18" class="techoutside Sq" data-pltdoc="x"><span class="techinside">will executor</span></a> has a will ready
for the value. The finalizer is invoked when the will for <span class="RktVar">obj</span>
becomes ready in the &ldquo;late&rdquo; will executor, which means that the
value is unreachable (even from wills) by safe code.</div></p><p>The finalizer is invoked in a thread that is in charge of triggering
will executors for <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._register-finalizer%29%29" class="RktValLink" data-pltdoc="x">register-finalizer</a></span>. The given
<span class="RktVar">finalizer</span> procedure should generally not rely on the
environment of the triggering thread, and it must not use any
parameters or call any parameter functions, except that relying on a
default logger and/or calling <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=logging.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-logger%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">current-logger</a></span> is allowed.</p><p>Finalizers are mostly intended to be used with cpointer objects (for
freeing unused memory that is not under GC control), but it can be
used with any Racket object&#8212;<wbr></wbr>even ones that have nothing to do with
foreign code.  Note, however, that the finalizer is registered for the
<span style="font-family: 楷体">Racket</span> object that represents the pointer. If you intend to
free a pointer object, then you must be careful to not register
finalizers for two cpointers that point to the same address.  Also, be
careful to not make the finalizer a closure that holds on to the
object. Finally, beware that the finalizer is not guaranteed to
be run when a place exits; see <a href="Allocation_and_Finalization.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">ffi/unsafe/alloc</span></a>
and <span class="RktSym"><a href="Custodian_Shutdown_Registration.html#%28def._%28%28lib._ffi%2Funsafe%2Fcustodian..rkt%29._register-finalizer-and-custodian-shutdown%29%29" class="RktValLink" data-pltdoc="x">register-finalizer-and-custodian-shutdown</a></span> for more
complete solutions.</p><p>As an example for <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._register-finalizer%29%29" class="RktValLink" data-pltdoc="x">register-finalizer</a></span>,
suppose that you&rsquo;re dealing with a foreign function that returns a
C string that you should free.  Here is an attempt at creating a suitable type:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">_sixteen-bytes/free</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._make-ctype%29%29" class="RktValLink" data-pltdoc="x">make-ctype</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Pointer_Types.html#%28def._%28%28quote._~23~25foreign%29.__pointer%29%29" class="RktValLink" data-pltdoc="x">_pointer</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">a Racket bytes can be used as a pointer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._make-sized-byte-string%29%29" class="RktValLink" data-pltdoc="x">make-sized-byte-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">16</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._register-finalizer%29%29" class="RktValLink" data-pltdoc="x">register-finalizer</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._free%29%29" class="RktValLink" data-pltdoc="x">free</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The above code is wrong: the finalizer is registered for <span class="RktSym">x</span>,
which is no longer needed after the byte string is created.  Changing
the example to register the finalizer for <span class="RktSym">b</span> corrects the problem,
but then <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._free%29%29" class="RktValLink" data-pltdoc="x">free</a></span> is invoked <span class="RktSym">b</span> it instead of on <span class="RktSym">x</span>.
In the process of fixing this problem, we might be careful and log a message
for debugging:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">_sixteen-bytes/free</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._make-ctype%29%29" class="RktValLink" data-pltdoc="x">make-ctype</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Pointer_Types.html#%28def._%28%28quote._~23~25foreign%29.__pointer%29%29" class="RktValLink" data-pltdoc="x">_pointer</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">a Racket bytes can be used as a pointer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._make-sized-byte-string%29%29" class="RktValLink" data-pltdoc="x">make-sized-byte-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">16</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._register-finalizer%29%29" class="RktValLink" data-pltdoc="x">register-finalizer</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ignored</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=logging.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._log-debug%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">log-debug</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._format%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Releasing ~s\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._free%29%29" class="RktValLink" data-pltdoc="x">free</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Now, we never see any logged event. The problem is that the finalizer is a
closure that keeps a reference to <span class="RktSym">b</span>. Instead of referencing the
value that is finalized, use the input argument to the finalizer; simply changing
<span class="RktSym">ignored</span> to <span class="RktSym">b</span> above solves the problem.  (Removing the
debugging message also avoids the problem, since the finalization
procedure would then not close over <span class="RktSym">b</span>.)</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._make-late-weak-box))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._make-late-weak-box%29%29" class="RktValDef RktValLink" data-pltdoc="x">make-late-weak-box</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=weakbox.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._weak-box%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">weak-box?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._make-late-weak-hasheq))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._make-late-weak-hasheq%29%29" class="RktValDef RktValLink" data-pltdoc="x">make-late-weak-hasheq</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._and%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">and/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">hash?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-eq%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">hash-eq?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash-weak%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">hash-weak?</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=weakbox.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-weak-box%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">make-weak-box</a></span> and <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-weak-hasheq%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">make-weak-hasheq</a></span>, but with
&ldquo;late&rdquo; weak references that last longer than references in the
result of <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=weakbox.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-weak-box%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">make-weak-box</a></span> or <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-weak-hasheq%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">make-weak-hasheq</a></span>.
Specifically, a &ldquo;late&rdquo; weak reference remains intact if a value is
unreachable but not yet processed by a finalizer installed with
<span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._register-finalizer%29%29" class="RktValLink" data-pltdoc="x">register-finalizer</a></span>. &ldquo;Late&rdquo; weak references are intended for
use by such finalizers.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._make-sized-byte-string))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._make-sized-byte-string%29%29" class="RktValDef RktValLink" data-pltdoc="x">make-sized-byte-string</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span><span class="RktVar">length</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cptr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">length</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a byte string made of the given pointer and the given length.
No copying is performed. Beware that future implementations of Racket
may not support this function (in case of a byte string representation
that combines a size and byte-string content without an indirection).</div></p><p>Beware also that the representation of a Racket byte string normally
requires a nul terminator at the end of the byte string (after
<span class="RktVar">length</span> bytes), but some functions work with a byte-string
representation that has no such terminator&#8212;<wbr></wbr>notably
<span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes-copy%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">bytes-copy</a></span>.</p><p>If <span class="RktVar">cptr</span> is an offset pointer created by <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-add%29%29" class="RktValLink" data-pltdoc="x">ptr-add</a></span>, the
offset is immediately added to the pointer. Thus, this function cannot
be used with <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._ptr-add%29%29" class="RktValLink" data-pltdoc="x">ptr-add</a></span> to create a substring of a Racket byte
string, because the offset pointer would be to the middle of a
collectable object (which is not allowed).</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe..rkt)._void/reference-sink))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._void%2Freference-sink%29%29" class="RktValDef RktValLink" data-pltdoc="x">void/reference-sink</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=guide&amp;rel=void_undefined.html&amp;version=7.0.0.18" class="RktModLink Sq" data-pltdoc="x"><span class="nobreak"><span class="RktRes">#&lt;void&gt;</span></span></a>, but unlike calling the <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void</a></span> function
where the compiler may optimize away the call and replace it with a
<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=guide&amp;rel=void_undefined.html&amp;version=7.0.0.18" class="RktModLink Sq" data-pltdoc="x"><span class="nobreak"><span class="RktRes">#&lt;void&gt;</span></span></a> result, calling <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._void%2Freference-sink%29%29" class="RktValLink" data-pltdoc="x">void/reference-sink</a></span> ensures
that the arguments are considered reachable by the garbage collector
until the call returns.</div></p><p class="SHistory">&#28155;&#21152;&#20110;package <span class="stt">base</span>&#30340;6.10.1.2&#29256;&#26412;&#12290;</p><h4 x-source-module="(lib &quot;scribblings/foreign/foreign.scrbl&quot;)" x-source-pkg="racket-doc" x-part-tag="&quot;Pointer_Structure_Property&quot;">4.3<tt>&nbsp;</tt><a name="(part._.Pointer_.Structure_.Property)"></a>Pointer Structure Property</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20540;</p></div></div><p class="RForeground"><a name="(def._((quote._~23~25foreign)._prop~3acpointer))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._prop~3acpointer%29%29" class="RktValDef RktValLink" data-pltdoc="x">prop:cpointer</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=structprops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._struct-type-property%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">struct-type-property?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=structprops.html%23%2528tech._structure._type._property%2529&amp;version=7.0.0.18" class="techoutside Sq" data-pltdoc="x"><span class="techinside">structure type property</span></a> that causes
instances of a structure type to work as C pointer values. The
property value must be either an exact non-negative integer indicating
an immutable field in the structure (which must, in turn, be
initialized to a C pointer value), a procedure that takes the
structure instance and returns a C pointer value, or a C pointer
value.</div></p><p>The <span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._prop~3acpointer%29%29" class="RktValLink" data-pltdoc="x">prop:cpointer</a></span> property allows a structure instance to be
used transparently as a C pointer value, or it allows a C pointer
value to be transparently wrapped by a structure that may have
additional values or properties.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="Enumerations_and_Masks.html" title="后退至&quot;3.10 Enumerations and Masks&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="index.html" title="上至&quot;The Racket Foreign Interface&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="Derived_Utilities.html" title="前进至&quot;5 Derived Utilities&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>