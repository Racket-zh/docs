<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>5.10&nbsp;Thread Scheduling</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Racket Foreign Interface</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Loading_Foreign_Libraries.html" class="tocviewlink" data-pltdoc="x">Loading Foreign Libraries</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="types.html" class="tocviewlink" data-pltdoc="x">C Types</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="foreign_pointer-funcs.html" class="tocviewlink" data-pltdoc="x">Pointer Functions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Derived_Utilities.html" class="tocviewselflink" data-pltdoc="x">Derived Utilities</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Miscellaneous_Support.html" class="tocviewlink" data-pltdoc="x">Miscellaneous Support</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="foreign_c-only.html" class="tocviewlink" data-pltdoc="x">Unexported Primitive Functions</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>5&nbsp;</td><td><a href="Derived_Utilities.html" class="tocviewlink" data-pltdoc="x">Derived Utilities</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.1&nbsp;</td><td><a href="homogeneous-vectors.html" class="tocviewlink" data-pltdoc="x">Safe Homogenous Vectors</a></td></tr><tr><td align="right">5.2&nbsp;</td><td><a href="foreign_cvector.html" class="tocviewlink" data-pltdoc="x">Safe C Vectors</a></td></tr><tr><td align="right">5.3&nbsp;</td><td><a href="foreign_tagged-pointers.html" class="tocviewlink" data-pltdoc="x">Tagged C Pointer Types</a></td></tr><tr><td align="right">5.4&nbsp;</td><td><a href="serialize-struct.html" class="tocviewlink" data-pltdoc="x">Serializable C Struct Types</a></td></tr><tr><td align="right">5.5&nbsp;</td><td><a href="Defining_Bindings.html" class="tocviewlink" data-pltdoc="x">Defining Bindings</a></td></tr><tr><td align="right">5.6&nbsp;</td><td><a href="Allocation_and_Finalization.html" class="tocviewlink" data-pltdoc="x">Allocation and Finalization</a></td></tr><tr><td align="right">5.7&nbsp;</td><td><a href="Custodian_Shutdown_Registration.html" class="tocviewlink" data-pltdoc="x">Custodian Shutdown Registration</a></td></tr><tr><td align="right">5.8&nbsp;</td><td><a href="Atomic_Execution.html" class="tocviewlink" data-pltdoc="x">Atomic Execution</a></td></tr><tr><td align="right">5.9&nbsp;</td><td><a href="Speculatively_Atomic_Execution.html" class="tocviewlink" data-pltdoc="x">Speculatively Atomic Execution</a></td></tr><tr><td align="right">5.10&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Thread Scheduling</a></td></tr><tr><td align="right">5.11&nbsp;</td><td><a href="Ports.html" class="tocviewlink" data-pltdoc="x">Ports</a></td></tr><tr><td align="right">5.12&nbsp;</td><td><a href="unsafe-global.html" class="tocviewlink" data-pltdoc="x">Process-<wbr></wbr>Wide and Place-<wbr></wbr>Wide Registration</a></td></tr><tr><td align="right">5.13&nbsp;</td><td><a href="Operating_System_Threads.html" class="tocviewlink" data-pltdoc="x">Operating System Threads</a></td></tr><tr><td align="right">5.14&nbsp;</td><td><a href="Garbage_Collection_Callbacks.html" class="tocviewlink" data-pltdoc="x">Garbage Collection Callbacks</a></td></tr><tr><td align="right">5.15&nbsp;</td><td><a href="Objective-C_FFI.html" class="tocviewlink" data-pltdoc="x">Objective-<wbr></wbr>C FFI</a></td></tr><tr><td align="right">5.16&nbsp;</td><td><a href="ns.html" class="tocviewlink" data-pltdoc="x">Cocoa Foundation</a></td></tr><tr><td align="right">5.17&nbsp;</td><td><a href="com.html" class="tocviewlink" data-pltdoc="x">COM (Common Object Model)</a></td></tr><tr><td align="right">5.18&nbsp;</td><td><a href="file-security-guard-checks.html" class="tocviewlink" data-pltdoc="x">File Security-<wbr></wbr>Guard Checks</a></td></tr><tr><td align="right">5.19&nbsp;</td><td><a href="winapi.html" class="tocviewlink" data-pltdoc="x">Windows API Helpers</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">在本页中：</div><table class="tocsublist" cellspacing="0"><tr><td><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poller%29%29" class="tocsublink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">unsafe-<wbr></wbr>poller</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poll-ctx-fd-wakeup%29%29" class="tocsublink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">unsafe-<wbr></wbr>poll-<wbr></wbr>ctx-<wbr></wbr>fd-<wbr></wbr>wakeup</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poll-ctx-eventmask-wakeup%29%29" class="tocsublink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">unsafe-<wbr></wbr>poll-<wbr></wbr>ctx-<wbr></wbr>eventmask-<wbr></wbr>wakeup</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poll-ctx-milliseconds-wakeup%29%29" class="tocsublink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">unsafe-<wbr></wbr>poll-<wbr></wbr>ctx-<wbr></wbr>milliseconds-<wbr></wbr>wakeup</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-set-sleep-in-thread%21%29%29" class="tocsublink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">unsafe-<wbr></wbr>set-<wbr></wbr>sleep-<wbr></wbr>in-<wbr></wbr>thread!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-signal-received%29%29" class="tocsublink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">unsafe-<wbr></wbr>signal-<wbr></wbr>received</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="Speculatively_Atomic_Execution.html" title="后退至&quot;5.9 Speculatively Atomic Execution&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="Derived_Utilities.html" title="上至&quot;5 Derived Utilities&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="Ports.html" title="前进至&quot;5.11 Ports&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div><h4 x-source-module="(lib &quot;scribblings/foreign/foreign.scrbl&quot;)" x-source-pkg="racket-doc" x-part-tag="&quot;Thread_Scheduling&quot;">5.10<tt>&nbsp;</tt><a name="(part._.Thread_.Scheduling)"></a><a name="(mod-path._ffi/unsafe/schedule)"></a>Thread Scheduling</h4><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">ffi/unsafe/schedule</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package&#65306;</span> <a href="https://pkgs.racket-lang.org/package/base" title="使用“raco pkg install base”安装此包"><span class="stt">base</span></a></span></td></tr></table></div><div class="SIntrapara">The
<a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">ffi/unsafe/schedule</span></a> library provides functions for
cooperating with the thread scheduler and manipulating it. The
library&rsquo;s operations are unsafe because callbacks run in <a href="Atomic_Execution.html#%28tech._atomic._mode%29" class="techoutside" data-pltdoc="x"><span class="techinside">atomic
mode</span></a> and in an unspecified thread.</div></p><p class="SHistory">&#28155;&#21152;&#20110;package <span class="stt">base</span>&#30340;6.11.0.1&#29256;&#26412;&#12290;</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe/schedule..rkt)._unsafe-poller))"></a><span title="提供自：ffi/unsafe/schedule | 包：base"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poller%29%29" class="RktValDef RktValLink" data-pltdoc="x">unsafe-poller</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">poll</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">poll</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._evt%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">evt?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">list?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._evt%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">evt?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Produces a <a name="(tech._poller)"></a><span style="font-family: 楷体">poller</span> value that is allowed as a
<span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._prop%7E3aevt%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">prop:evt</a></span> value, even though it is not a procedure or itself
an <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._evt%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">evt?</a></span>. The <span class="RktVar">poll</span> callback is called in <a href="Atomic_Execution.html#%28tech._atomic._mode%29" class="techoutside" data-pltdoc="x"><span class="techinside">atomic
mode</span></a> in an unspecified thread to check whether the event is ready or
to allow it to register a wakeup trigger.</div></p><p>The first argument to <span class="RktVar">poll</span> is always the object that is used
as a <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528tech._synchronizable._event%2529&amp;version=7.0.0.18" class="techoutside Sq" data-pltdoc="x"><span class="techinside">synchronizable event</span></a> with the
<a href="#%28tech._poller%29" class="techoutside" data-pltdoc="x"><span class="techinside">poller</span></a> as its <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=sync.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._prop%7E3aevt%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">prop:evt</a></span> value. Let&rsquo;s call that value
<span class="RktVar">evt</span>.</p><p>The second argument to <span class="RktVar">poll</span> is <span class="RktVal">#f</span> when <span class="RktVar">poll</span>
is called to check whether the event is ready. The result must be two
values. The first result value is a list of results if <span class="RktVar">evt</span>
is ready, or it is <span class="RktVal">#f</span> if <span class="RktVar">evt</span> is not ready. The
second result value is <span class="RktVal">#f</span> if <span class="RktVar">evt</span> is ready, or it is
an event to replace <span class="RktVar">evt</span> (often just <span class="RktVar">evt</span> itself) if
<span class="RktVar">evt</span> is not ready.</p><p>When the thread scheduler has determined that the Racket process
should sleep until an external event or timeout, then <span class="RktVar">poll</span> is
called with a non-<span class="RktVal">#f</span> second argument, <span class="RktVar">wakeups</span>. In
that case, if the first result value is a list, then the sleep will be
canceled, but the list is not recorded as the result (and <span class="RktVar">poll</span>
most likely will be called again). In addition to returning a <span class="RktVal">#f</span> initial
value, <span class="RktVar">poll</span> can call <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poll-ctx-fd-wakeup%29%29" class="RktValLink" data-pltdoc="x">unsafe-poll-ctx-fd-wakeup</a></span>,
<span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poll-ctx-eventmask-wakeup%29%29" class="RktValLink" data-pltdoc="x">unsafe-poll-ctx-eventmask-wakeup</a></span>, and/or
<span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poll-ctx-milliseconds-wakeup%29%29" class="RktValLink" data-pltdoc="x">unsafe-poll-ctx-milliseconds-wakeup</a></span> on <span class="RktVar">wakeups</span> to
register wakeup triggers.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe/schedule..rkt)._unsafe-poll-ctx-fd-wakeup))"></a><span title="提供自：ffi/unsafe/schedule | 包：base"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poll-ctx-fd-wakeup%29%29" class="RktValDef RktValLink" data-pltdoc="x">unsafe-poll-ctx-fd-wakeup</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">wakeups</span><span class="hspace">&nbsp;</span><span class="RktVar">fd</span><span class="hspace">&nbsp;</span><span class="RktVar">mode</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">wakeups</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">fd</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._fixnum%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">fixnum?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mode</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">read</span><span class="hspace">&nbsp;</span><span class="RktVal">write</span><span class="hspace">&nbsp;</span><span class="RktVal">error</span><span class="RktVal">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Registers a file descriptor (Unix and Mac OS) or socket (all
platforms) to cause the Racket process to wake up and resume polling
if the file descriptor or socket becomes ready for reading, writing,
or error reporting, as selected by <span class="RktVar">mode</span>. The <span class="RktVar">wakeups</span>
argument must be a non-<span class="RktVal">#f</span> value that is passed by the
scheduler to a <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poller%29%29" class="RktValLink" data-pltdoc="x">unsafe-poller</a></span>-wrapped procedure.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe/schedule..rkt)._unsafe-poll-ctx-eventmask-wakeup))"></a><span title="提供自：ffi/unsafe/schedule | 包：base"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poll-ctx-eventmask-wakeup%29%29" class="RktValDef RktValLink" data-pltdoc="x">unsafe-poll-ctx-eventmask-wakeup</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">wakeups</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">mask</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">wakeups</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">mask</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._fixnum%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">fixnum?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">On Windows, registers an eventmask to cause the Racket process to wake
up and resume polling if an event selected by the mask becomes
available.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe/schedule..rkt)._unsafe-poll-ctx-milliseconds-wakeup))"></a><span title="提供自：ffi/unsafe/schedule | 包：base"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-poll-ctx-milliseconds-wakeup%29%29" class="RktValDef RktValLink" data-pltdoc="x">unsafe-poll-ctx-milliseconds-wakeup</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">wakeups</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">msecs</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">wakeups</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">msecs</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._flonum%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">flonum?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Causes the Racket process will wake up and resume polling at the point
when <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=time.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-inexact-milliseconds%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">current-inexact-milliseconds</a></span><span class="RktPn">)</span> starts returning a value
that is <span class="RktVar">msecs</span> or greater.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe/schedule..rkt)._unsafe-set-sleep-in-thread!))"></a><span title="提供自：ffi/unsafe/schedule | 包：base"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-set-sleep-in-thread%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">unsafe-set-sleep-in-thread!</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">foreground-sleep</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">fd</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">foreground-sleep</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">fd</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._fixnum%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">fixnum?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Registers <span class="RktVar">foreground-sleep</span> as a procedure to implement
sleeping for the Racket process when the thread scheduler determines
at the process will sleep. Meanwhile, during a call to
<span class="RktVar">foreground-sleep</span>, the scheduler&rsquo;s default sleeping function
will run in a separate OS-level thread. When that default sleeping
function wakes up, a byte is written to <span class="RktVar">fd</span> as a way of
notifying <span class="RktVar">foreground-sleep</span> that it should return
immediately.</div></p><p>This function works on when OS-level threads are available within the
Racket implementation. It always works for Mac OS.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe/schedule..rkt)._unsafe-signal-received))"></a><span title="提供自：ffi/unsafe/schedule | 包：base"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-signal-received%29%29" class="RktValDef RktValLink" data-pltdoc="x">unsafe-signal-received</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">For use with <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe%2Fschedule..rkt%29._unsafe-set-sleep-in-thread%21%29%29" class="RktValLink" data-pltdoc="x">unsafe-set-sleep-in-thread!</a></span> by
<span class="RktVar">foreground-sleep</span> or something that it triggers, causes the
default sleeping function to request <span class="RktVar">foreground-sleep</span> to
return.</div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="Speculatively_Atomic_Execution.html" title="后退至&quot;5.9 Speculatively Atomic Execution&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="Derived_Utilities.html" title="上至&quot;5 Derived Utilities&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="Ports.html" title="前进至&quot;5.11 Ports&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>