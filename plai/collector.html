<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2&nbsp;GC Collector Scheme</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x"><span style="font-family: 楷体">Programming Languages:<span class="mywbr"> &nbsp;</span> Application and Interpretation</span></a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="plai-scheme.html" class="tocviewlink" data-pltdoc="x">PLAI Scheme</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">GC Collector Scheme</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="mutator.html" class="tocviewlink" data-pltdoc="x">GC Mutator Scheme</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="gc2-collector.html" class="tocviewlink" data-pltdoc="x">GC Collector Language, 2</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="gc2-mutator.html" class="tocviewlink" data-pltdoc="x">GC Mutator Language, 2</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Generating_Random_Mutators.html" class="tocviewlink" data-pltdoc="x">Generating Random Mutators</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="web.html" class="tocviewlink" data-pltdoc="x">Web Application Scheme</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>2&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">GC Collector Scheme</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="#%28part._.Garbage_.Collector_.Interface%29" class="tocviewlink" data-pltdoc="x">Garbage Collector Interface</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="#%28part._.Garbage_.Collector_.Exports%29" class="tocviewlink" data-pltdoc="x">Garbage Collector Exports</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">在本页中：</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Garbage_.Collector_.Interface%29" class="tocsubseclink" data-pltdoc="x">Garbage Collector Interface</a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-size%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">heap-<wbr></wbr>size</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">location?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._root~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">root?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-value~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">heap-<wbr></wbr>value?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-set%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">heap-<wbr></wbr>set!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-ref%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">heap-<wbr></wbr>ref</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._plai%2Fcollector..rkt%29._get-root-set%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">get-<wbr></wbr>root-<wbr></wbr>set</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._read-root%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">read-<wbr></wbr>root</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._set-root%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">set-<wbr></wbr>root!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._procedure-roots%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">procedure-<wbr></wbr>roots</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._plai%2Fcollector..rkt%29._with-heap%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">with-<wbr></wbr>heap</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._plai%2Fcollector..rkt%29._with-roots%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">with-<wbr></wbr>roots</span></a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.Garbage_.Collector_.Exports%29" class="tocsubseclink" data-pltdoc="x">Garbage Collector Exports</a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._init-allocator%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">init-<wbr></wbr>allocator</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aderef%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> &nbsp;</span>deref</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aalloc-flat%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> &nbsp;</span>alloc-<wbr></wbr>flat</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3acons%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> &nbsp;</span>cons</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3afirst%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> &nbsp;</span>first</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3arest%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> &nbsp;</span>rest</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aset-first%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> &nbsp;</span>set-<wbr></wbr>first!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aset-rest%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> &nbsp;</span>set-<wbr></wbr>rest!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3acons~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> &nbsp;</span>cons?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aflat~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">gc:<span class="mywbr"> &nbsp;</span>flat?</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="plai-scheme.html" title="后退至&quot;1 PLAI Scheme&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="index.html" title="上至&quot;Programming Languages: Application and Interpretation&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="mutator.html" title="前进至&quot;3 GC Mutator Scheme&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;plai/scribblings/plai.scrbl&quot;)" x-source-pkg="plai-doc" x-part-tag="&quot;collector&quot;">2<tt>&nbsp;</tt><a name="(part._collector)"></a><a name="(mod-path._plai/collector)"></a>GC Collector Scheme</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=7.0.0.18" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">plai/collector</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package&#65306;</span> <a href="https://pkgs.racket-lang.org/package/plai-lib" title="使用“raco pkg install plai-lib”安装此包"><span class="stt">plai-lib</span></a></span></td></tr></table></p><p>GC Collector Scheme is based on <a href="plai-scheme.html" data-pltdoc="x">PLAI Scheme</a>.  It provides
additional procedures and syntax for writing garbage collectors.</p><h4 x-source-module="(lib &quot;plai/scribblings/plai.scrbl&quot;)" x-source-pkg="plai-doc" x-part-tag="&quot;Garbage_Collector_Interface&quot;">2.1<tt>&nbsp;</tt><a name="(part._.Garbage_.Collector_.Interface)"></a>Garbage Collector Interface</h4><p>The GC Collector Scheme language provides the following functions that provide access
to the heap and root set:</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._heap-size))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-size%29%29" class="RktValDef RktValLink" data-pltdoc="x">heap-size</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Returns the size of the heap.  The size of the heap is specified by the mutator
that uses the garbage collector.  See <span class="RktSym"><a href="mutator.html#%28form._%28%28lib._plai%2Fscribblings%2Ffake-mutator..rkt%29._allocator-setup%29%29" class="RktStxLink" data-pltdoc="x">allocator-setup</a></span> for more
information.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._location~3f))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">location?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Determines if <span class="RktVar">v</span> is an integer between <span class="RktVal">0</span> and
<span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-size%29%29" class="RktValLink" data-pltdoc="x">heap-size</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span> inclusive.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._root~3f))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._root~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">root?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Determines if <span class="RktVar">v</span> is a root.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._heap-value~3f))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-value~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">heap-value?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A value that may be stored on the heap. Roughly corresponds to the contract
<span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._number%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">number?</a></span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=symbols.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._symbol%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">symbol?</a></span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._empty%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">empty?</a></span><span class="RktPn">)</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._heap-set!))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-set%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">heap-set!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-value~3f%29%29" class="RktValLink" data-pltdoc="x">heap-value?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Sets the value at <span class="RktVar">loc</span> to <span class="RktVar">val</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._heap-ref))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-ref%29%29" class="RktValDef RktValLink" data-pltdoc="x">heap-ref</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-value~3f%29%29" class="RktValLink" data-pltdoc="x">heap-value?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the value at <span class="RktVar">loc</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._plai/collector..rkt)._get-root-set))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28form._%28%28lib._plai%2Fcollector..rkt%29._get-root-set%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">get-root-set</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Returns the current roots as a list.  Local roots are created for the
identifiers <span class="RktVar">id</span> as well.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._read-root))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._read-root%29%29" class="RktValDef RktValLink" data-pltdoc="x">read-root</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">root</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">root</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._root~3f%29%29" class="RktValLink" data-pltdoc="x">root?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the location of <span class="RktVar">root</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._set-root!))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._set-root%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">set-root!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">root</span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">root</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._root~3f%29%29" class="RktValLink" data-pltdoc="x">root?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Updates the root to reference the given location.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/collector..rkt)._procedure-roots))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._procedure-roots%29%29" class="RktValDef RktValLink" data-pltdoc="x">procedure-roots</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">proc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._root~3f%29%29" class="RktValLink" data-pltdoc="x">root?</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Given a closure stored on the heap, returns a list of the roots reachable
from the closure&rsquo;s environment.  If <span class="RktVar">proc</span> is not reachable, the
empty list is returned.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._plai/collector..rkt)._with-heap))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><a href="#%28form._%28%28lib._plai%2Fcollector..rkt%29._with-heap%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">with-heap</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">heap-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">body-expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">heap-expr</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fvector..rkt%2529._vectorof%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-value~3f%29%29" class="RktValLink" data-pltdoc="x">heap-value?</a></span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Evaluates each of the <span class="RktVar">body-expr</span>s in a context where
the value of <span class="RktVar">heap-expr</span> is used as the heap. Useful in
tests:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="plai-scheme.html#%28form._%28%28lib._plai%2Fmain..rkt%29._test%29%29" class="RktStxLink" data-pltdoc="x">test</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._plai%2Fcollector..rkt%29._with-heap%29%29" class="RktStxLink" data-pltdoc="x">with-heap</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-vector%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">make-vector</a></span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._init-allocator%29%29" class="RktValLink" data-pltdoc="x">init-allocator</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aderef%29%29" class="RktValLink" data-pltdoc="x">gc:deref</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aalloc-flat%29%29" class="RktValLink" data-pltdoc="x">gc:alloc-flat</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._plai/collector..rkt)._with-roots))"></a><span title="提供自：plai/collector | 包：plai-lib"><span class="RktSym"><span class="RktSymDef RktSym">with-roots</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">roots-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr1</span><span class="hspace">&nbsp;</span><span class="RktVar">expr2</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">roots-expr</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Evaluates each of <span class="RktVar">expr1</span> and the <span class="RktVar">expr2</span>s in
in a context with the result of <span class="RktVar">roots-expr</span>
as additional roots.</div></p><p><div class="SIntrapara">This function is intended to be used in test suites
for collectors. Since your test suites are not running
in the </div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=7.0.0.18" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="mutator.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">plai/mutator</span></a></p></blockquote></div><div class="SIntrapara"> language, <span class="RktSym"><a href="#%28form._%28%28lib._plai%2Fcollector..rkt%29._get-root-set%29%29" class="RktStxLink" data-pltdoc="x">get-root-set</a></span>
returns a list consisting only of the roots it created,
not all of the other roots it normally would return.
Use this function to note specific locations as roots
and set up better tests for your GC.</div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="plai-scheme.html#%28form._%28%28lib._plai%2Fmain..rkt%29._test%29%29" class="RktStxLink" data-pltdoc="x">test</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._plai%2Fcollector..rkt%29._with-heap%29%29" class="RktStxLink" data-pltdoc="x">with-heap</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-vector%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">make-vector</a></span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aalloc-flat%29%29" class="RktValLink" data-pltdoc="x">gc:alloc-flat</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3acons%29%29" class="RktValLink" data-pltdoc="x">gc:cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f1</span><span class="hspace">&nbsp;</span><span class="RktSym">f1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">with-roots</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aderef%29%29" class="RktValLink" data-pltdoc="x">gc:deref</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3afirst%29%29" class="RktValLink" data-pltdoc="x">gc:first</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3acons%29%29" class="RktValLink" data-pltdoc="x">gc:cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f1</span><span class="hspace">&nbsp;</span><span class="RktSym">f1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr></table></blockquote><h4 x-source-module="(lib &quot;plai/scribblings/plai.scrbl&quot;)" x-source-pkg="plai-doc" x-part-tag="&quot;Garbage_Collector_Exports&quot;">2.2<tt>&nbsp;</tt><a name="(part._.Garbage_.Collector_.Exports)"></a>Garbage Collector Exports</h4><p>A garbage collector must define the following functions:</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._init-allocator))"></a><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._init-allocator%29%29" class="RktValDef RktValLink" data-pltdoc="x">init-allocator</a></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara"><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._init-allocator%29%29" class="RktValLink" data-pltdoc="x">init-allocator</a></span> is called before all other procedures by a
mutator. Place any requisite initialization code here.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aderef))"></a><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aderef%29%29" class="RktValDef RktValLink" data-pltdoc="x">gc:deref</a></span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-value~3f%29%29" class="RktValLink" data-pltdoc="x">heap-value?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Given the location of a flat Scheme value, this procedure should return that
value.  If the location does not hold a flat value, this function should signal
an error.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aalloc-flat))"></a><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aalloc-flat%29%29" class="RktValDef RktValLink" data-pltdoc="x">gc:alloc-flat</a></span><span class="hspace">&nbsp;</span><span class="RktVar">val</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._heap-value~3f%29%29" class="RktValLink" data-pltdoc="x">heap-value?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">This procedure should allocate a flat Scheme value (number, symbol, boolean,
closure or empty list) on the heap, returning its location (a number). The
value should occupy a single heap cell, though you may use additional space to
store a tag, etc. You are also welcome to pre-allocate common constants (e.g.,
the empty list). This procedure may need to perform a garbage-collection. If
there is still insufficient space, it should signal an error.</div></p><p>Note that closures are flat values. The environment of a closure is internally
managed, but contains references to values on the heap. Therefore, during
garbage collection, the environment of reachable closures must be updated. The
language exposes the environment via the <span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._procedure-roots%29%29" class="RktValLink" data-pltdoc="x">procedure-roots</a></span> function.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3acons))"></a><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3acons%29%29" class="RktValDef RktValLink" data-pltdoc="x">gc:cons</a></span><span class="hspace">&nbsp;</span><span class="RktVar">first</span><span class="hspace">&nbsp;</span><span class="RktVar">rest</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">first</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">rest</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Given the location of the <span class="RktVar">first</span> and <span class="RktVar">rest</span> values, this
procedure must allocate a cons cell on the heap.  If there is insufficient
space to allocate the cons cell, it should signal an error.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3afirst))"></a><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3afirst%29%29" class="RktValDef RktValLink" data-pltdoc="x">gc:first</a></span><span class="hspace">&nbsp;</span><span class="RktVar">cons-cell</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If the given location refers to a cons cell, this should return the first
field. Otherwise, it should signal an error.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3arest))"></a><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3arest%29%29" class="RktValDef RktValLink" data-pltdoc="x">gc:rest</a></span><span class="hspace">&nbsp;</span><span class="RktVar">cons-cell</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If the given location refers to a cons cell, this should return the rest
field. Otherwise, it should signal an error.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aset-first!))"></a><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aset-first%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">gc:set-first!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span><span class="RktVar">first-value</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">first-value</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If <span class="RktVar">cons-cell</span> refers to a cons cell, set the head of the cons cell to
<span class="RktVar">first-value</span>.  Otherwise, signal an error.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aset-rest!))"></a><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aset-rest%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">gc:set-rest!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span><span class="RktVar">rest-value</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cons-cell</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">rest-value</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">If <span class="RktVar">cons-cell</span> refers to a cons cell, set the tail of the cons cell to
<span class="RktVar">rest-value</span>.  Otherwise, signal an error.</div></p><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3acons~3f))"></a><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3acons~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">gc:cons?</a></span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr></table></blockquote><p>Returns <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528lib._racket%252Fbool..rkt%2529._true%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">true</a></span> if <span class="RktVar">loc</span> refers to a cons cell.  This function
should never signal an error.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._plai/scribblings/fake-collector..rkt)._gc~3aflat~3f))"></a><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fscribblings%2Ffake-collector..rkt%29._gc~3aflat~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">gc:flat?</a></span><span class="hspace">&nbsp;</span><span class="RktVar">loc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">loc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._plai%2Fcollector..rkt%29._location~3f%29%29" class="RktValLink" data-pltdoc="x">location?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528lib._racket%252Fbool..rkt%2529._true%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">true</a></span> if <span class="RktVar">loc</span> refers to a flat value.  This function
should never signal an error.</div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="plai-scheme.html" title="后退至&quot;1 PLAI Scheme&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="index.html" title="上至&quot;Programming Languages: Application and Interpretation&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="mutator.html" title="前进至&quot;3 GC Mutator Scheme&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>