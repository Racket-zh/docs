<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>13&nbsp;String Encodings</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Inside:<span class="mywbr"> &nbsp;</span> Racket C API</a></td></tr></table></div><div class="tocviewsublistonly" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="overview.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="embedding.html" class="tocviewlink" data-pltdoc="x">Embedding into a Program</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Writing_Racket_Extensions.html" class="tocviewlink" data-pltdoc="x">Writing Racket Extensions</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="im_values_types.html" class="tocviewlink" data-pltdoc="x">Values and Types</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="im_memoryalloc.html" class="tocviewlink" data-pltdoc="x">Memory Allocation</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="im_env.html" class="tocviewlink" data-pltdoc="x">Namespaces and Modules</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Procedures.html" class="tocviewlink" data-pltdoc="x">Procedures</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Evaluation.html" class="tocviewlink" data-pltdoc="x">Evaluation</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="exceptions.html" class="tocviewlink" data-pltdoc="x">Exceptions and Escape Continuations</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="threads.html" class="tocviewlink" data-pltdoc="x">Threads</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="config.html" class="tocviewlink" data-pltdoc="x">Parameterizations</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="contmarks.html" class="tocviewlink" data-pltdoc="x">Continuation Marks</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">String Encodings</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="Bignums__Rationals__and_Complex_Numbers.html" class="tocviewlink" data-pltdoc="x">Bignums, Rationals, and Complex Numbers</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="Ports_and_the_Filesystem.html" class="tocviewlink" data-pltdoc="x">Ports and the Filesystem</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="Structures.html" class="tocviewlink" data-pltdoc="x">Structures</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="security.html" class="tocviewlink" data-pltdoc="x">Security Guards</a></td></tr><tr><td align="right">18&nbsp;</td><td><a href="Custodians.html" class="tocviewlink" data-pltdoc="x">Custodians</a></td></tr><tr><td align="right">19&nbsp;</td><td><a href="Subprocesses.html" class="tocviewlink" data-pltdoc="x">Subprocesses</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="Miscellaneous_Utilities.html" class="tocviewlink" data-pltdoc="x">Miscellaneous Utilities</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="contmarks.html" title="后退至&quot;12 Continuation Marks&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="index.html" title="上至&quot;Inside: Racket C API&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="Bignums__Rationals__and_Complex_Numbers.html" title="前进至&quot;14 Bignums, Rationals, and Complex Numbers&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;scribblings/inside/inside.scrbl&quot;)" x-source-pkg="racket-doc" x-part-tag="&quot;im:encodings&quot;">13<tt>&nbsp;</tt><a name="(part._im~3aencodings)"></a>String Encodings</h3><p>The <a href="#%28cpp._scheme_utf8_decode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode</span></a> function decodes a <span class="stt">char</span> array as
UTF-8 into either a UCS-4 <span class="stt">mzchar</span> array or a UTF-16 <span class="stt">short</span>
array. The <a href="#%28cpp._scheme_utf8_encode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_encode</span></a> function encodes either a UCS-4
<span class="stt">mzchar</span> array or a UTF-16 <span class="stt">short</span> array into a UTF-8
<span class="stt">char</span> array.</p><p>These functions can be used to check or measure an encoding or
decoding without actually producing the result decoding or encoding,
and variations of the function provide control over the handling of
decoding errors.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">int</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_decode)"></a><a name="(idx._(gentag._449._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_decode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const unsigned char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">start</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">end</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">us</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">dstart</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">dend</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">intptr_t*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">ipos</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">char</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">utf16</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">permissive</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Decodes a byte array as UTF-8 to produce either Unicode code points
 into <span style="font-family: 楷体">us</span> (when <span style="font-family: 楷体">utf16</span> is zero) or UTF-16 code units into
 <span style="font-family: 楷体">us</span> cast to <span class="stt">short*</span> (when <span style="font-family: 楷体">utf16</span> is non-zero). No nul
 terminator is added to <span style="font-family: 楷体">us</span>.</div></p><p>The result is non-negative when all of the given bytes are decoded,
 and the result is the length of the decoding (in <span class="stt">mzchar</span>s or
 <span class="stt">short</span>s). A <span class="stt">-2</span> result indicates an invalid encoding
 sequence in the given bytes (possibly because the range to decode
 ended mid-encoding), and a <span class="stt">-3</span> result indicates that decoding
 stopped because not enough room was available in the result string.</p><p>The <span style="font-family: 楷体">start</span> and <span style="font-family: 楷体">end</span> arguments specify a range of <span style="font-family: 楷体">s</span> to
 be decoded. If <span style="font-family: 楷体">end</span> is negative, <span class="stt">strlen(</span><span style="font-family: 楷体">s</span><span class="stt">)</span> is used
 as the end.</p><p>If <span style="font-family: 楷体">us</span> is <span class="stt">NULL</span>, then decoded bytes are not produced, but
 the result is valid as if decoded bytes were written. The
 <span style="font-family: 楷体">dstart</span> and <span style="font-family: 楷体">dend</span> arguments specify a target range in
 <span style="font-family: 楷体">us</span> (in <span class="stt">mzchar</span> or <span class="stt">short</span> units) for the decoding; a
 negative value for <span style="font-family: 楷体">dend</span> indicates that any number of bytes can
 be written to <span style="font-family: 楷体">us</span>, which is normally sensible only when <span style="font-family: 楷体">us</span>
 is <span class="stt">NULL</span> for measuring the length of the decoding.</p><p>If <span style="font-family: 楷体">ipos</span> is non-<span class="stt">NULL</span>, it is filled with the first undecoded
 index within <span style="font-family: 楷体">s</span>. If the function result is non-negative, then
 <span class="stt">*</span><span style="font-family: 楷体">ipos</span> is set to the ending index (with is <span style="font-family: 楷体">end</span> if
 non-negative, <span class="stt">strlen(</span><span style="font-family: 楷体">s</span><span class="stt">)</span> otherwise). If the result is
 <span class="stt">-1</span> or <span class="stt">-2</span>, then <span class="stt">*</span><span style="font-family: 楷体">ipos</span> effectively indicates
 how many bytes were decoded before decoding stopped.</p><p>If <span style="font-family: 楷体">permissive</span> is non-zero, it is used as the decoding of bytes
 that are not part of a valid UTF-8 encoding or if the input ends in the
 middle of an encoding. Thus, the function
 result can be <span class="stt">-1</span> or <span class="stt">-2</span> only if <span style="font-family: 楷体">permissive</span> is <span class="stt">0</span>.</p><p>On Windows, when <span style="font-family: 楷体">utf16</span> is non-zero, decoding supports a natural
 extension of UTF-8 that can produce unpaired UTF-16 surrogates in the
 result.</p><p>This function does not allocate or trigger garbage collection.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">int</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_decode_offset_prefix)"></a><a name="(idx._(gentag._450._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_decode_offset_prefix%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode_offset_prefix</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const unsigned char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">start</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">end</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">us</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">dstart</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">dend</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">intptr_t*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">ipos</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">char</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">utf16</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">permissive</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Like <a href="#%28cpp._scheme_utf8_decode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode</span></a>, but returns <span class="stt">-1</span> if the input ends
in the middle of a UTF-8 encoding even if <span style="font-family: 楷体">permission</span> is
non-zero.</div></p><p class="SHistory">&#28155;&#21152;&#20110;6.0.1.13&#29256;&#26412;&#12290;</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">int</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_decode_as_prefix)"></a><a name="(idx._(gentag._451._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_decode_as_prefix%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode_as_prefix</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const unsigned char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">start</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">end</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">us</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">dstart</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">dend</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">intptr_t*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">ipos</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">char</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">utf16</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">permissive</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Like <a href="#%28cpp._scheme_utf8_decode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode</span></a>, but the result is always the number
 of the decoded <span class="stt">mzchar</span>s or <span class="stt">short</span>s. If a decoding error is
 encountered, the result is still the size of the decoding up until
 the error.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">int</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_decode_all)"></a><a name="(idx._(gentag._452._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_decode_all%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode_all</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const unsigned char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">len</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">us</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">permissive</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Like <a href="#%28cpp._scheme_utf8_decode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode</span></a>, but with fewer arguments. The
 decoding produces UCS-4 <span class="stt">mzchar</span>s. If the buffer <span style="font-family: 楷体">us</span> is
 non-<span class="stt">NULL</span>, it is assumed to be long enough to hold the decoding
 (which cannot be longer than the length of the input, though it may
 be shorter). If <span style="font-family: 楷体">len</span> is negative, <span class="stt">strlen(</span><span style="font-family: 楷体">s</span><span class="stt">)</span> is used
 as the input length.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">int</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_decode_prefix)"></a><a name="(idx._(gentag._453._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_decode_prefix%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode_prefix</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const unsigned char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">len</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">us</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">permissive</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Like <a href="#%28cpp._scheme_utf8_decode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode</span></a>, but with fewer arguments. The
 decoding produces UCS-4 <span class="stt">mzchar</span>s. The buffer <span style="font-family: 楷体">us</span>
 <span style="font-weight: bold">must</span> be non-<span class="stt">NULL</span>, and it is assumed to be long enough to hold the
 decoding (which cannot be longer than the length of the input, though
 it may be shorter). If <span style="font-family: 楷体">len</span> is negative, <span class="stt">strlen(</span><span style="font-family: 楷体">s</span><span class="stt">)</span>
 is used as the input length.</div></p><p>In addition to the result of <a href="#%28cpp._scheme_utf8_decode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode</span></a>, the result
 can be <span class="stt">-1</span> to indicate that the input ended with a partial
 (valid) encoding. A <span class="stt">-1</span> result is possible even when
 <span style="font-family: 楷体">permissive</span> is non-zero.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">mzchar*</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_decode_to_buffer)"></a><a name="(idx._(gentag._454._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_decode_to_buffer%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode_to_buffer</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const unsigned char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">len</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">buf</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">blen</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Like <a href="#%28cpp._scheme_utf8_decode_all%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode_all</span></a> with <span style="font-family: 楷体">permissive</span> as <span class="stt">0</span>,
 but if <span style="font-family: 楷体">buf</span> is not large enough (as indicated by <span style="font-family: 楷体">blen</span>) to
 hold the result, a new buffer is allocated. Unlike other functions,
 this one adds a nul terminator to the decoding result. The function
 result is either <span style="font-family: 楷体">buf</span> (if it was big enough) or a buffer
 allocated with <a href="im_memoryalloc.html#%28cpp._scheme_malloc_atomic%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_malloc_atomic</span></a>.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">mzchar*</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_decode_to_buffer_len)"></a><a name="(idx._(gentag._455._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_decode_to_buffer_len%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode_to_buffer_len</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const unsigned char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">len</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">buf</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">blen</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">intptr_t*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">ulen</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Like <a href="#%28cpp._scheme_utf8_decode_to_buffer%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode_to_buffer</span></a>, but the length of the
 result (not including the terminator) is placed into <span style="font-family: 楷体">ulen</span> if
 <span style="font-family: 楷体">ulen</span> is non-<span class="stt">NULL</span>.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">int</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_decode_count)"></a><a name="(idx._(gentag._456._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_decode_count%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode_count</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const unsigned char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">start</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">end</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">state</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">might_continue</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">permissive</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Like <a href="#%28cpp._scheme_utf8_decode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode</span></a>, but without producing the decoded
 <span class="stt">mzchar</span>s, and always returning the number of decoded
 <span class="stt">mzchar</span>s up until a decoding error (if any). If
 <span style="font-family: 楷体">might_continue</span> is non-zero, the a partial valid encoding at
 the end of the input is not decoded when <span style="font-family: 楷体">permissive</span> is also
 non-zero.</div></p><p>If <span style="font-family: 楷体">state</span> is non-<span class="stt">NULL</span>, it holds information about partial
 encodings; it should be set to zero for an initial call, and then
 passed back to <a href="#%28cpp._scheme_utf8_decode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_decode</span></a> along with bytes that
 extend the given input (i.e., without any unused partial
 encodings). Typically, this mode makes sense only when
 <span style="font-family: 楷体">might_continue</span> and <span style="font-family: 楷体">permissive</span> are non-zero.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">int</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_encode)"></a><a name="(idx._(gentag._457._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_encode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_encode</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">us</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">start</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">end</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">unsigned char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">dstart</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">char</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">utf16</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Encodes the given UCS-4 array of <span class="stt">mzchar</span>s (if <span style="font-family: 楷体">utf16</span> is
 zero) or UTF-16 array of <span class="stt">short</span>s (if <span style="font-family: 楷体">utf16</span> is non-zero)
 into <span style="font-family: 楷体">s</span>. The <span style="font-family: 楷体">end</span> argument must be no less than
 <span style="font-family: 楷体">start</span>.</div></p><p>The array <span style="font-family: 楷体">s</span> is assumed to be long enough to contain the
 encoding, but no encoding is written if <span style="font-family: 楷体">s</span> is <span class="stt">NULL</span>. The
 <span style="font-family: 楷体">dstart</span> argument indicates a starting place in <span style="font-family: 楷体">s</span> to hold
 the encoding. No nul terminator is added to <span style="font-family: 楷体">s</span>.</p><p>The result is the number of bytes produced for the encoding (or that
 would be produced if <span style="font-family: 楷体">s</span> was non-<span class="stt">NULL</span>). Encoding never
 fails.</p><p>On Windows, when <span style="font-family: 楷体">utf16</span> is non-zero, encoding supports unpaired
 surrogates the input UTF-16 code-unit sequence, in which case
 encoding generates a natural extension of UTF-8 that encodes unpaired
 surrogates.</p><p>This function does not allocate or trigger garbage collection.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">int</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_encode_all)"></a><a name="(idx._(gentag._458._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_encode_all%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_encode_all</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">us</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">len</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">unsigned char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Like <a href="#%28cpp._scheme_utf8_encode%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_encode</span></a> with <span class="stt">0</span> for <span style="font-family: 楷体">start</span>,
 <span style="font-family: 楷体">len</span> for <span style="font-family: 楷体">end</span>, <span class="stt">0</span> for <span style="font-family: 楷体">dstart</span> and <span class="stt">0</span> for
 <span style="font-family: 楷体">utf16</span>.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">char*</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_encode_to_buffer)"></a><a name="(idx._(gentag._459._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_encode_to_buffer%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_encode_to_buffer</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">len</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">buf</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">blen</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Like <a href="#%28cpp._scheme_utf8_encode_all%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_encode_all</span></a>, but the length of <span style="font-family: 楷体">buf</span> is
 given, and if it is not long enough to hold the encoding, a buffer is
 allocated. A nul terminator is added to the encoded array. The result
 is either <span style="font-family: 楷体">buf</span> or an array allocated with
 <a href="im_memoryalloc.html#%28cpp._scheme_malloc_atomic%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_malloc_atomic</span></a>.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">char*</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf8_encode_to_buffer_len)"></a><a name="(idx._(gentag._460._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf8_encode_to_buffer_len%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_encode_to_buffer_len</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">s</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">len</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">char*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">buf</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">blen</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">intptr_t*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">rlen</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Like <a href="#%28cpp._scheme_utf8_encode_to_buffer%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf8_encode_to_buffer</span></a>, but the length of the
 resulting encoding (not including a nul terminator) is reported in
 <span style="font-family: 楷体">rlen</span> if it is non-<span class="stt">NULL</span>.</div></p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">unsigned-short*</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_ucs4_to_utf16)"></a><a name="(idx._(gentag._461._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_ucs4_to_utf16%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_ucs4_to_utf16</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">text</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">start</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">end</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">unsigned short*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">buf</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">bufsize</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">intptr_t*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">ulen</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">term_size</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Converts a UCS-4 encoding (the indicated range of <span style="font-family: 楷体">text</span>) to a
 UTF-16 encoding. The <span style="font-family: 楷体">end</span> argument must be no less than
 <span style="font-family: 楷体">start</span>.</div></p><p>A result buffer is allocated if <span style="font-family: 楷体">buf</span> is not long enough (as
 indicated by <span style="font-family: 楷体">bufsize</span>). If <span style="font-family: 楷体">ulen</span> is non-<span class="stt">NULL</span>, it is
 filled with the length of the UTF-16 encoding. The <span style="font-family: 楷体">term_size</span>
 argument indicates a number of <span class="stt">short</span>s to reserve at the end of
 the result buffer for a terminator (but no terminator is actually
 written).</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">mzchar*</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><a name="(cpp._scheme_utf16_to_ucs4)"></a><a name="(idx._(gentag._462._(lib._scribblings/inside/inside..scrbl)))"></a><a href="#%28cpp._scheme_utf16_to_ucs4%29" class="RktStxLink" data-pltdoc="x"><span class="stt">scheme_utf16_to_ucs4</span></a></p></td><td><p><span class="stt">(</span></p></td><td><p><span class="stt">const unsigned short*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">text</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">start</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">end</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">mzchar*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">buf</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">bufsize</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">intptr_t*</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">ulen</span><span class="stt">,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span><span class="hspace">&nbsp;</span><span style="font-family: 楷体">term_size</span><span class="stt">)</span></p></td></tr></table></td></tr></table></div><div class="SIntrapara">Converts a UTF-16 encoding (the indicated range of <span style="font-family: 楷体">text</span>) to a
 UCS-4 encoding. The <span style="font-family: 楷体">end</span> argument must be no less than
 <span style="font-family: 楷体">start</span>.</div></p><p>A result buffer is allocated if <span style="font-family: 楷体">buf</span> is not long enough (as
 indicated by <span style="font-family: 楷体">bufsize</span>). If <span style="font-family: 楷体">ulen</span> is non-<span class="stt">NULL</span>, it is
 filled with the length of the UCS-4 encoding. The <span style="font-family: 楷体">term_size</span>
 argument indicates a number of <span class="stt">mzchar</span>s to reserve at the end of
 the result buffer for a terminator (but no terminator is actually
 written).</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="contmarks.html" title="后退至&quot;12 Continuation Marks&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="index.html" title="上至&quot;Inside: Racket C API&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="Bignums__Rationals__and_Complex_Numbers.html" title="前进至&quot;14 Bignums, Rationals, and Complex Numbers&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>