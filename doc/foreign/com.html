<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>5.17&nbsp;COM (Common Object Model)</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Racket Foreign Interface</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Loading_Foreign_Libraries.html" class="tocviewlink" data-pltdoc="x">Loading Foreign Libraries</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="types.html" class="tocviewlink" data-pltdoc="x">C Types</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="foreign_pointer-funcs.html" class="tocviewlink" data-pltdoc="x">Pointer Functions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Derived_Utilities.html" class="tocviewselflink" data-pltdoc="x">Derived Utilities</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Miscellaneous_Support.html" class="tocviewlink" data-pltdoc="x">Miscellaneous Support</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="foreign_c-only.html" class="tocviewlink" data-pltdoc="x">Unexported Primitive Functions</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>5&nbsp;</td><td><a href="Derived_Utilities.html" class="tocviewlink" data-pltdoc="x">Derived Utilities</a></td></tr></table><div class="tocviewsublist" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.1&nbsp;</td><td><a href="homogeneous-vectors.html" class="tocviewlink" data-pltdoc="x">Safe Homogenous Vectors</a></td></tr><tr><td align="right">5.2&nbsp;</td><td><a href="foreign_cvector.html" class="tocviewlink" data-pltdoc="x">Safe C Vectors</a></td></tr><tr><td align="right">5.3&nbsp;</td><td><a href="foreign_tagged-pointers.html" class="tocviewlink" data-pltdoc="x">Tagged C Pointer Types</a></td></tr><tr><td align="right">5.4&nbsp;</td><td><a href="serialize-struct.html" class="tocviewlink" data-pltdoc="x">Serializable C Struct Types</a></td></tr><tr><td align="right">5.5&nbsp;</td><td><a href="Defining_Bindings.html" class="tocviewlink" data-pltdoc="x">Defining Bindings</a></td></tr><tr><td align="right">5.6&nbsp;</td><td><a href="Allocation_and_Finalization.html" class="tocviewlink" data-pltdoc="x">Allocation and Finalization</a></td></tr><tr><td align="right">5.7&nbsp;</td><td><a href="Custodian_Shutdown_Registration.html" class="tocviewlink" data-pltdoc="x">Custodian Shutdown Registration</a></td></tr><tr><td align="right">5.8&nbsp;</td><td><a href="Atomic_Execution.html" class="tocviewlink" data-pltdoc="x">Atomic Execution</a></td></tr><tr><td align="right">5.9&nbsp;</td><td><a href="Speculatively_Atomic_Execution.html" class="tocviewlink" data-pltdoc="x">Speculatively Atomic Execution</a></td></tr><tr><td align="right">5.10&nbsp;</td><td><a href="Thread_Scheduling.html" class="tocviewlink" data-pltdoc="x">Thread Scheduling</a></td></tr><tr><td align="right">5.11&nbsp;</td><td><a href="Ports.html" class="tocviewlink" data-pltdoc="x">Ports</a></td></tr><tr><td align="right">5.12&nbsp;</td><td><a href="unsafe-global.html" class="tocviewlink" data-pltdoc="x">Process-<wbr></wbr>Wide and Place-<wbr></wbr>Wide Registration</a></td></tr><tr><td align="right">5.13&nbsp;</td><td><a href="Operating_System_Threads.html" class="tocviewlink" data-pltdoc="x">Operating System Threads</a></td></tr><tr><td align="right">5.14&nbsp;</td><td><a href="Garbage_Collection_Callbacks.html" class="tocviewlink" data-pltdoc="x">Garbage Collection Callbacks</a></td></tr><tr><td align="right">5.15&nbsp;</td><td><a href="Objective-C_FFI.html" class="tocviewlink" data-pltdoc="x">Objective-<wbr></wbr>C FFI</a></td></tr><tr><td align="right">5.16&nbsp;</td><td><a href="ns.html" class="tocviewlink" data-pltdoc="x">Cocoa Foundation</a></td></tr><tr><td align="right">5.17&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">COM (Common Object Model)</a></td></tr><tr><td align="right">5.18&nbsp;</td><td><a href="file-security-guard-checks.html" class="tocviewlink" data-pltdoc="x">File Security-<wbr></wbr>Guard Checks</a></td></tr><tr><td align="right">5.19&nbsp;</td><td><a href="winapi.html" class="tocviewlink" data-pltdoc="x">Windows API Helpers</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9660;</a></td><td>5.17&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">COM (Common Object Model)</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.17.1&nbsp;</td><td><a href="com-auto.html" class="tocviewlink" data-pltdoc="x">COM Automation</a></td></tr><tr><td align="right">5.17.2&nbsp;</td><td><a href="com-intf.html" class="tocviewlink" data-pltdoc="x">COM Classes and Interfaces</a></td></tr><tr><td align="right">5.17.3&nbsp;</td><td><a href="active-x.html" class="tocviewlink" data-pltdoc="x">Active<span class="mywbr"> &nbsp;</span>X Controls</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="ns.html" title="后退至&quot;5.16 Cocoa Foundation&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="Derived_Utilities.html" title="上至&quot;5 Derived Utilities&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="com-auto.html" title="前进至&quot;5.17.1 COM Automation&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div><h4 x-source-module="(lib &quot;scribblings/foreign/foreign.scrbl&quot;)" x-source-pkg="racket-doc" x-part-tag="&quot;com&quot;">5.17<tt>&nbsp;</tt><a name="(part._com)"></a>COM (Common Object Model)</h4><p>The <a href="com-auto.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">ffi/com</span></a> and <a href="com-intf.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">ffi/unsafe/com</span></a>
libraries support COM interaction in two layers. The safe upper layer
provides functions for creating COM objects and dynamically
constructing method calls based on COM automation (i.e., reflective
information provided by the object). The unsafe lower layer provides a
syntactic form and functions for working more directly with COM
objects and interfaces.</p><p>A <a name="(tech._com._object)"></a><span style="font-family: 楷体">COM object</span> instantiates a particular <a name="(tech._com._clas)"></a><span style="font-family: 楷体">COM
class</span>. A <a href="#%28tech._com._clas%29" class="techoutside" data-pltdoc="x"><span class="techinside">COM class</span></a> can be specified in either of two ways:</p><ul><li><p>A <a name="(tech._clsid)"></a><span style="font-family: 楷体">CLSID</span> (class id), which is represented as a
<a href="#%28tech._guid%29" class="techoutside" data-pltdoc="x"><span class="techinside">GUID</span></a>. A <a name="(tech._guid)"></a><span style="font-family: 楷体">GUID</span> (globally unique identifier) is a
16-byte structure. GUIDs are typically written in string forms such
as <span class="RktVal">"{A3B0AF9E-2AB0-11D4-B6D2-0060089002FE}"</span>. The
<span class="RktSym"><a href="com-auto.html#%28def._%28%28lib._ffi%2Funsafe%2Fcom..rkt%29._string-~3eguid%29%29" class="RktValLink" data-pltdoc="x">string-&gt;guid</a></span> and <span class="RktSym"><a href="com-auto.html#%28def._%28%28lib._ffi%2Funsafe%2Fcom..rkt%29._guid-~3estring%29%29" class="RktValLink" data-pltdoc="x">guid-&gt;string</a></span> convert between
string and <a href="#%28tech._guid%29" class="techoutside" data-pltdoc="x"><span class="techinside">GUID</span></a> forms. The <span class="RktSym"><a href="com-auto.html#%28def._%28%28lib._ffi%2Funsafe%2Fcom..rkt%29._string-~3eclsid%29%29" class="RktValLink" data-pltdoc="x">string-&gt;clsid</a></span> function is
the same as <span class="RktSym"><a href="com-auto.html#%28def._%28%28lib._ffi%2Funsafe%2Fcom..rkt%29._string-~3eguid%29%29" class="RktValLink" data-pltdoc="x">string-&gt;guid</a></span>, but its use suggests that the
resulting <a href="#%28tech._guid%29" class="techoutside" data-pltdoc="x"><span class="techinside">GUID</span></a> is to be used as a <a href="#%28tech._clsid%29" class="techoutside" data-pltdoc="x"><span class="techinside">CLSID</span></a>.</p></li><li><p>A <a name="(tech._progid)"></a><span style="font-family: 楷体">ProgID</span> is a human-readable name, such as
<span class="RktVal">"MzCom.MzObj.5.2.0.7"</span>, which includes a version number. The
version number can be omitted in a <a href="#%28tech._progid%29" class="techoutside" data-pltdoc="x"><span class="techinside">ProgID</span></a>, in which case the
most recent available version is used. The operating system provides
a mapping between <a href="#%28tech._progid%29" class="techoutside" data-pltdoc="x"><span class="techinside">ProgIDs</span></a> and <a href="#%28tech._clsid%29" class="techoutside" data-pltdoc="x"><span class="techinside">CLSIDs</span></a> that is available
via <span class="RktSym"><a href="com-auto.html#%28def._%28%28lib._ffi%2Funsafe%2Fcom..rkt%29._progid-~3eclsid%29%29" class="RktValLink" data-pltdoc="x">progid-&gt;clsid</a></span> and <span class="RktSym"><a href="com-auto.html#%28def._%28%28lib._ffi%2Funsafe%2Fcom..rkt%29._clsid-~3eprogid%29%29" class="RktValLink" data-pltdoc="x">clsid-&gt;progid</a></span>.</p></li></ul><p>A <a href="#%28tech._com._object%29" class="techoutside" data-pltdoc="x"><span class="techinside">COM object</span></a> can be instantiated either on the local machine or
on a remote machine. The latter relies on the operating system&rsquo;s
<a name="(tech._dcom)"></a><span style="font-family: 楷体">DCOM</span> (distributed COM) support.</p><p>Each <a href="#%28tech._com._object%29" class="techoutside" data-pltdoc="x"><span class="techinside">COM object</span></a> supports some number of <a name="(tech._com._interface)"></a><span style="font-family: 楷体">COM
interfaces</span>. A <a href="#%28tech._com._interface%29" class="techoutside" data-pltdoc="x"><span class="techinside">COM interface</span></a> has a programmatic name, such as
<span class="stt">IDispatch</span>, that corresponds to a C-layer protocol. Each
interface also has an <a name="(tech._iid)"></a><span style="font-family: 楷体">IID</span> (interface id) that is represented
as a <a href="#%28tech._guid%29" class="techoutside" data-pltdoc="x"><span class="techinside">GUID</span></a> such as
<span class="RktVal">"{00020400-0000-0000-C000-000000000046}"</span>. Direct calls to COM
methods require extracting a suitable interface pointer from an object
using <span class="RktSym"><a href="com-intf.html#%28def._%28%28lib._ffi%2Funsafe%2Fcom..rkt%29._.Query.Interface%29%29" class="RktValLink" data-pltdoc="x">QueryInterface</a></span> and the desired <a href="#%28tech._iid%29" class="techoutside" data-pltdoc="x"><span class="techinside">IID</span></a>; the result
is effectively cast it to a pointer to a dispatch-table pointer, where
the dispatch table has a statically known size and foreign-function
content. The <span class="RktSym"><a href="com-intf.html#%28form._%28%28lib._ffi%2Funsafe%2Fcom..rkt%29._define-com-interface%29%29" class="RktStxLink" data-pltdoc="x">define-com-interface</a></span> form simplifies description
and use of interface pointers. The COM automation layer uses a fixed
number of reflection interfaces internally, notably <span class="stt">IDispatch</span>,
to call methods by name and with safe argument marshaling.</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html" class="toclink" data-pltdoc="x">5.17.1<span class="hspace">&nbsp;</span>COM Automation</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#%28part._.G.U.I.Ds__.C.L.S.I.Ds__.I.I.Ds__and_.Prog.I.Ds%29" class="toclink" data-pltdoc="x">5.17.1.1<span class="hspace">&nbsp;</span>GUIDs, CLSIDs, IIDs, and ProgIDs</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#%28part._.C.O.M_.Objects%29" class="toclink" data-pltdoc="x">5.17.1.2<span class="hspace">&nbsp;</span>COM Objects</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#%28part._.C.O.M_.Methods%29" class="toclink" data-pltdoc="x">5.17.1.3<span class="hspace">&nbsp;</span>COM Methods</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#%28part._.C.O.M_.Properties%29" class="toclink" data-pltdoc="x">5.17.1.4<span class="hspace">&nbsp;</span>COM Properties</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#%28part._.C.O.M_.Events%29" class="toclink" data-pltdoc="x">5.17.1.5<span class="hspace">&nbsp;</span>COM Events</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#%28part._.C.O.M_.Enumerations%29" class="toclink" data-pltdoc="x">5.17.1.6<span class="hspace">&nbsp;</span>COM Enumerations</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#%28part._.Interface_.Pointers%29" class="toclink" data-pltdoc="x">5.17.1.7<span class="hspace">&nbsp;</span>Interface Pointers</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#%28part._remote%29" class="toclink" data-pltdoc="x">5.17.1.8<span class="hspace">&nbsp;</span>Remote COM servers (DCOM)</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#%28part._com-types%29" class="toclink" data-pltdoc="x">5.17.1.9<span class="hspace">&nbsp;</span>COM Types</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#%28part._.Class_.Display_.Names%29" class="toclink" data-pltdoc="x">5.17.1.10<span class="hspace">&nbsp;</span>Class Display Names</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-intf.html" class="toclink" data-pltdoc="x">5.17.2<span class="hspace">&nbsp;</span>COM Classes and Interfaces</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-intf.html#%28part._.Describing_.C.O.M_.Interfaces%29" class="toclink" data-pltdoc="x">5.17.2.1<span class="hspace">&nbsp;</span>Describing COM Interfaces</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-intf.html#%28part._.Obtaining_.C.O.M_.Interface_.References%29" class="toclink" data-pltdoc="x">5.17.2.2<span class="hspace">&nbsp;</span>Obtaining COM Interface References</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-intf.html#%28part._.C.O.M_.F.F.I_.Helpers%29" class="toclink" data-pltdoc="x">5.17.2.3<span class="hspace">&nbsp;</span>COM FFI Helpers</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-intf.html#%28part._com-intf-example%29" class="toclink" data-pltdoc="x">5.17.2.4<span class="hspace">&nbsp;</span>COM Interface Example</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="active-x.html" class="toclink" data-pltdoc="x">5.17.3<span class="hspace">&nbsp;</span>ActiveX Controls</a></p></td></tr></table><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="ns.html" title="后退至&quot;5.16 Cocoa Foundation&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="Derived_Utilities.html" title="上至&quot;5 Derived Utilities&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="com-auto.html" title="前进至&quot;5.17.1 COM Automation&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>