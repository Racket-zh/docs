<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>3.6&nbsp;Function Types</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Racket Foreign Interface</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Loading_Foreign_Libraries.html" class="tocviewlink" data-pltdoc="x">Loading Foreign Libraries</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="types.html" class="tocviewselflink" data-pltdoc="x">C Types</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="foreign_pointer-funcs.html" class="tocviewlink" data-pltdoc="x">Pointer Functions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Derived_Utilities.html" class="tocviewlink" data-pltdoc="x">Derived Utilities</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Miscellaneous_Support.html" class="tocviewlink" data-pltdoc="x">Miscellaneous Support</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="foreign_c-only.html" class="tocviewlink" data-pltdoc="x">Unexported Primitive Functions</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>3&nbsp;</td><td><a href="types.html" class="tocviewlink" data-pltdoc="x">C Types</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="ctype.html" class="tocviewlink" data-pltdoc="x">Type Constructors</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="Numeric_Types.html" class="tocviewlink" data-pltdoc="x">Numeric Types</a></td></tr><tr><td align="right">3.3&nbsp;</td><td><a href="Other_Atomic_Types.html" class="tocviewlink" data-pltdoc="x">Other Atomic Types</a></td></tr><tr><td align="right">3.4&nbsp;</td><td><a href="String_Types.html" class="tocviewlink" data-pltdoc="x">String Types</a></td></tr><tr><td align="right">3.5&nbsp;</td><td><a href="Pointer_Types.html" class="tocviewlink" data-pltdoc="x">Pointer Types</a></td></tr><tr><td align="right">3.6&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Function Types</a></td></tr><tr><td align="right">3.7&nbsp;</td><td><a href="C_Struct_Types.html" class="tocviewlink" data-pltdoc="x">C Struct Types</a></td></tr><tr><td align="right">3.8&nbsp;</td><td><a href="C_Array_Types.html" class="tocviewlink" data-pltdoc="x">C Array Types</a></td></tr><tr><td align="right">3.9&nbsp;</td><td><a href="C_Union_Types.html" class="tocviewlink" data-pltdoc="x">C Union Types</a></td></tr><tr><td align="right">3.10&nbsp;</td><td><a href="Enumerations_and_Masks.html" class="tocviewlink" data-pltdoc="x">Enumerations and Masks</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td>3.6&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Function Types</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.6.1&nbsp;</td><td><a href="#%28part._foreign~3acustom-types%29" class="tocviewlink" data-pltdoc="x">Custom Function Types</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">在本页中：</div><table class="tocsublist" cellspacing="0"><tr><td><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__cprocedure%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">_<span class="mywbr"> &nbsp;</span>cprocedure</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">_<span class="mywbr"> &nbsp;</span>fun</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._function-ptr%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">function-<wbr></wbr>ptr</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink"><span class="nobreak">-<wbr></wbr>&gt;</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.6.1<tt>&nbsp;</tt></span><a href="#%28part._foreign~3acustom-types%29" class="tocsubseclink" data-pltdoc="x">Custom Function Types</a></td></tr><tr><td><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._define-fun-syntax%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>fun-<wbr></wbr>syntax</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">_<span class="mywbr"> &nbsp;</span>?</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__ptr%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">_<span class="mywbr"> &nbsp;</span>ptr</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__box%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">_<span class="mywbr"> &nbsp;</span>box</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__list%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">_<span class="mywbr"> &nbsp;</span>list</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__vector%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">_<span class="mywbr"> &nbsp;</span>vector</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">_<span class="mywbr"> &nbsp;</span>bytes</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%2Fnul-terminated%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">_<span class="mywbr"> &nbsp;</span>bytes/<span class="mywbr"> &nbsp;</span>nul-<wbr></wbr>terminated</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="Pointer_Types.html" title="后退至&quot;3.5 Pointer Types&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="types.html" title="上至&quot;3 C Types&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="C_Struct_Types.html" title="前进至&quot;3.7 C Struct Types&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div><h4 x-source-module="(lib &quot;scribblings/foreign/foreign.scrbl&quot;)" x-source-pkg="racket-doc" x-part-tag="&quot;foreign:procedures&quot;">3.6<tt>&nbsp;</tt><a name="(part._foreign~3aprocedures)"></a>Function Types</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe..rkt).__cprocedure))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__cprocedure%29%29" class="RktValDef RktValLink" data-pltdoc="x">_cprocedure</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">input-types</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">output-type</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span>[</td><td valign="top"><span class="RktPn">#:abi</span><span class="hspace">&nbsp;</span><span class="RktVar">abi</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:atomic?</span><span class="hspace">&nbsp;</span><span class="RktVar">atomic?</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:async-apply</span><span class="hspace">&nbsp;</span><span class="RktVar">async-apply</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:lock-name</span><span class="hspace">&nbsp;</span><span class="RktVar">lock-name</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:in-original-place?</span><span class="hspace">&nbsp;</span><span class="RktVar">in-original-place?</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:blocking?</span><span class="hspace">&nbsp;</span><span class="RktVar">blocking?</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:save-errno</span><span class="hspace">&nbsp;</span><span class="RktVar">save-errno</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:wrapper</span><span class="hspace">&nbsp;</span><span class="RktVar">wrapper</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:keep</span><span class="hspace">&nbsp;</span><span class="RktVar">keep</span>]<span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">any</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">input-types</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">output-type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">abi</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">default</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">stdcall</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sysv</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">atomic?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">async-apply</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._box%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">box?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">lock-name</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">in-original-place?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">blocking?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">save-errno</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">posix</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">windows</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">wrapper</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">keep</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._box%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">box?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#t</span></td></tr></table></blockquote></div><div class="SIntrapara">A type constructor that creates a new function type, which is
specified by the given <span class="RktVar">input-types</span> list and <span class="RktVar">output-type</span>.
Usually, the <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span> syntax (described below) should be used
instead, since it manages a wide range of complicated cases.</div></p><p>The resulting type can be used to reference foreign functions (usually
<span class="RktSym">ffi-obj</span>s, but any pointer object can be referenced with this type),
generating a matching foreign <a name="(tech._callout)"></a><span style="font-family: 楷体">callout</span> object.  Such objects are new primitive
procedure objects that can be used like any other Racket procedure.
As with other pointer types, <span class="RktVal">#f</span> is treated as a <span class="stt">NULL</span>
function pointer and vice versa.</p><p>A type created with <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__cprocedure%29%29" class="RktValLink" data-pltdoc="x">_cprocedure</a></span> can also be used for passing
Racket procedures to foreign functions, which will generate a foreign
function pointer that calls to the given Racket <a name="(tech._callback)"></a><span style="font-family: 楷体">callback</span>
procedure.  There are no restrictions on the Racket procedure; in
particular, its lexical context is properly preserved.</p><p>The optional <span class="RktVar">abi</span> keyword argument determines the foreign ABI
that is used. Supplying <span class="RktVal">#f</span> or <span class="RktVal">'</span><span class="RktVal">default</span> indicates the
platform-dependent default. The other possible
values&#8212;<wbr></wbr><span class="RktVal">'</span><span class="RktVal">stdcall</span> and <span class="RktVal">'</span><span class="RktVal">sysv</span> (i.e., &ldquo;cdecl&rdquo;)&#8212;<wbr></wbr>are
currently supported only for 32-bit Windows; using them on other
platforms raises an exception. See also <a href="winapi.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">ffi/winapi</span></a>.</p><p>For <a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callouts</span></a> to foreign functions with the generated type:</p><ul><li><p>If <span class="RktVar">save-errno</span> is <span class="RktVal">'</span><span class="RktVal">posix</span>, then the value of
<a name="(idx._(gentag._4._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="stt">errno</span> is saved (specific to the current thread)
immediately after a foreign function <a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a>
returns. The saved value is accessible through
<span class="RktSym"><a href="Miscellaneous_Support.html#%28def._%28%28quote._~23~25foreign%29._saved-errno%29%29" class="RktValLink" data-pltdoc="x">saved-errno</a></span>. If <span class="RktVar">save-errno</span> is
<span class="RktVal">'</span><span class="RktVal">windows</span>, then the value of
<a name="(idx._(gentag._5._(lib._scribblings/foreign/foreign..scrbl)))"></a><span class="stt">GetLastError</span><span class="stt">()</span> is saved for later use via
<span class="RktSym"><a href="Miscellaneous_Support.html#%28def._%28%28quote._~23~25foreign%29._saved-errno%29%29" class="RktValLink" data-pltdoc="x">saved-errno</a></span>; the <span class="RktVal">'</span><span class="RktVal">windows</span> option is available
only on Windows (on other platforms <span class="RktSym"><a href="Miscellaneous_Support.html#%28def._%28%28quote._~23~25foreign%29._saved-errno%29%29" class="RktValLink" data-pltdoc="x">saved-errno</a></span> will
return 0). If <span class="RktVar">save-errno</span> is <span class="RktVal">#f</span>, no error
value is saved automatically.</p><p>The error-recording support provided by <span class="RktVar">save-errno</span> is
needed because the Racket runtime system may otherwise preempt
the current Racket thread and itself call functions that set
error values.</p></li><li><p>If <span class="RktVar">wrapper</span> is not <span class="RktVal">#f</span>, it takes the
<a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a> that would otherwise be generated and returns a
replacement procedure. Thus, <span class="RktVar">wrapper</span> acts a hook to
perform various argument manipulations before the true
<a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a> is invoked, and it can return different results
(for example, grabbing a value stored in an &ldquo;output&rdquo; pointer
and returning multiple values).</p></li><li><p>If <span class="RktVar">lock-name</span> is not <span class="RktVal">#f</span>, then a process-wide
lock with the given name is held during the foreign call. In a
build that supports parallel places, <span class="RktVar">lock-name</span> is
registered via <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=inside&amp;rel=Miscellaneous_Utilities.html%23%2528cpp._scheme_register_process_global%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="stt">scheme_register_process_global</span></a>, so choose
names that are suitably distinct.</p></li><li><p>If <span class="RktVar">in-original-place?</span> is true, then when a foreign
<a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a> procedure with the generated type is called in
any Racket <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=places.html%23%2528tech._place%2529&amp;version=7.0.0.18" class="techoutside Sq" data-pltdoc="x"><span class="techinside">place</span></a>, the procedure
is called from the original Racket place. Use this mode for a
foreign function that is not thread-safe at the C level, which
means that it is not place-safe at the Racket
level. <a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">Callbacks</span></a> from place-unsafe code back into Racket
at a non-original place typically will not work, since the
place of the Racket code may have a different allocator than
the original place.</p></li><li><p>If <span class="RktVar">blocking?</span> is true, then a foreign <a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a>
deactivates tracking of the calling OS thread&#8212;<wbr></wbr>to the degree
supported by the Racket variant&#8212;<wbr></wbr>during the foreign call. The
value of <span class="RktVar">blocking?</span> affects only the <a href="http://docs.racket-lang.org/local-redirect/index.html?doc=guide&amp;rel=performance.html%23%2528tech._c%2529&amp;version=7.0.0.18" class="techoutside Sq" data-pltdoc="x"><span class="techinside">CS</span></a> variant of Racket, where it enable activity
such as garbage collection in other OS threads while the
<a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a> blocks. If the blocking <a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a> can
invoke any <a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">callbacks</span></a> back to Racket, those
<a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">callbacks</span></a> must be constructed with a non-<span class="RktVal">#f</span>
value of <span class="RktVar">async-apply</span>, even if they are always applied
in the OS thread used to run Racket.</p></li><li><p>Values that are provided to a <a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a> (i.e., the
underlying callout, and not the replacement produced by a
<span class="RktVar">wrapper</span>, if any) are always considered reachable by the
garbage collector until the called foreign function returns. If
the foreign function invokes Racket callbacks, however, beware
that values managed by the Racket garbage collector might be
moved in memory by the garbage collector.</p></li><li><p>A <a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a> object is finalized internally. Beware
of trying to use a <a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a> object that is reachable
only from a finalized object, since the two objects
might be finalized in either order.</p></li></ul><p>For <a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">callbacks</span></a> to Racket functions with the generated type:</p><ul><li><p>The <span class="RktVar">keep</span> argument provides control over reachbility by
   the garbage collector of the underlying value that foreign code
   see as a plain C function.  Additional care must be taken in
   case the foreign code might retain the callback function, in
   which case the callback value must remain reachable or else the
   held callback will become invalid.  The possible values of
   <span class="RktVar">keep</span> are as follows:</p><ul><li><p><span class="RktVal">#t</span> &#8212;<wbr></wbr> the <a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">callback</span></a> stays in memory as long
as the converted Racket function is reachable. This mode is the
default, as it is fine in most cases. Note that each Racket
function can hold onto only one callback value through this
mode, so it is not suitable for a function used multiple times
as a reatined callback.</p></li><li><p><span class="RktVal">#f</span> &#8212;<wbr></wbr> the <a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">callback</span></a> value is not held.  This
mode may be useful for a callback that is only used for the
duration of the foreign call; for example, the comparison
function argument to the standard C library <span class="stt">qsort</span> function
is only used while <span class="stt">qsort</span> is working, and no additional
references to the comparison function are kept.  Use this option
only in such cases, when no holding is necessary and you want to
avoid the extra cost.</p></li><li><p>A box holding <span class="RktVal">#f</span> or any other non-list value &#8212;<wbr></wbr> the
callback value is stored in the box, overriding any non-list
value that was in the box (making it useful for holding a single
callback value).  When you know that the callback is no longer
needed, you can &ldquo;release&rdquo; the callback value by changing the
box contents or by allowing the box itself to become
unreachable.  This mode can be useful if the box is held for a
dynamic extent that corresponds to when the callback is needed;
for example, you might encapsulate some foreign functionality in
a Racket class or a unit, and keep the callback box as a field
in new instances or instantiations of the unit.</p></li><li><p>A box holding <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._null%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">null</a></span> (or any list) &#8212;<wbr></wbr> similar to a
box holding a non-list value, except that new callback values are
<span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">cons</a></span>ed onto the contents of the box.  This mode is
therefore useful in cases when a Racket function is used
in multiple callbacks (that is, sent to foreign code to hold
onto multiple times) and all callbacks should be retained together.</p></li><li><p>A one-argument function &#8212;<wbr></wbr> the function is invoked with the
callback value when it is generated.  This mode allows you to
explicitly manage reachability of the generated callback closure.</p></li></ul></li><li><p>If <span class="RktVar">wrapper</span> is not <span class="RktVal">#f</span>, it takes the procedure
to be converted into a <a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">callback</span></a> and returns a
replacement procedure to be invoked as the callback. Thus,
<span class="RktVar">wrapper</span> acts a hook to perform various argument
manipulations before a Racket callback function is called, and
it can return different results to the foreign caller.</p><p>The callback value&rsquo;s reachability (and its interaction with
<span class="RktVar">keep</span> is based on the original function for the
callback, not the result of <span class="RktVar">wrapper</span>.</p></li><li><p>If <span class="RktVar">atomic?</span> is true, then when a Racket procedure is
given this procedure type and called as a <a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">callback</span></a> from
foreign code, then the Racket process is put into atomic mode
while evaluating the Racket procedure body.</p><p>In atomic mode, other Racket threads do not run, so the Racket
code must not call any function that potentially blocks on
synchronization with other threads, or else it may lead to
deadlock. In addition, the Racket code must not perform any
potentially blocking operation (such as I/O), it must not raise
an uncaught exception, it must not perform any escaping
continuation jumps, and its non-tail recursion must be minimal
to avoid C-level stack overflow; otherwise, the process may
crash or misbehave.</p></li><li><p>If a <span class="RktVar">async-apply</span> is provided as a procedure or box, then a Racket
<a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">callback</span></a> procedure with the generated procedure type can
be applied in a foreign thread (i.e., an OS-level thread other
than the one used to run Racket).</p><p>If <span class="RktVar">async-apply</span> is a procedure, the call in the foreign
thread is transferred to the OS-level thread that runs Racket,
but the Racket-level thread (in the sense of <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=threads.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._thread%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">thread</a></span>)
is unspecified; the job of the provided <span class="RktVar">async-apply</span>
procedure is to arrange for the callback procedure to be run in
a suitable Racket thread.</p><p>The given <span class="RktVar">async-apply</span>
procedure is applied to a thunk that encapsulates the specific
callback invocation, and the foreign OS-level thread blocks
until the thunk is called and completes; the thunk must be
called exactly once, and the callback invocation must return
normally. The given <span class="RktVar">async-apply</span> procedure itself is
called in atomic mode (see <span class="RktVar">atomic?</span> above).</p><p>If the callback is known to complete quickly, requires no
synchronization, and works independent of the Racket thread in
which it runs, then it is safe for the given
<span class="RktVar">async-apply</span> procedure to apply the thunk
directly. Otherwise, the given <span class="RktVar">async-apply</span> procedure
must arrange for the thunk to be applied in a suitable Racket
thread sometime after the given <span class="RktVar">async-apply</span> procedure
itself returns; if the thunk raises an exception or
synchronizes within an unsuitable Racket-level thread, it can
deadlock or otherwise damage the Racket process.</p><p>If <span class="RktVar">async-apply</span> is a box, then the value contained in
the box is used as the result of the callback when it is called
in a foreign thread; the <span class="RktVar">async-apply</span> value is
converted to a foreign value at the time that
<span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__cprocedure%29%29" class="RktValLink" data-pltdoc="x">_cprocedure</a></span> is called. Using a boxed constant value
for <span class="RktVar">async-apply</span> avoids the need to synchronize with
the OS-level thread that runs Racket, but it effectively ignores
the Racket procedure that is wrapped as <a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">callback</span></a> when
the <a href="#%28tech._callback%29" class="techoutside" data-pltdoc="x"><span class="techinside">callback</span></a> is applied in a foreign thread.</p><p>Foreign-thread detection to trigger <span class="RktVar">async-apply</span> works
only when Racket is compiled with OS-level thread support,
which is the default for many platforms. If a callback with an
<span class="RktVar">async-apply</span> is called from foreign code in the same
OS-level thread that runs Racket, then <span class="RktVar">async-apply</span>
is not used.</p></li></ul><p class="SHistory">&#20462;&#25913;&#20110;package <span class="stt">base</span>&#30340;6.3&#29256;&#26412;&#65306;Added the <span class="RktPn">#:lock-name</span> argument.<br/>&#20462;&#25913;&#20110;6.12.0.2&#29256;&#26412;&#65306;Added the <span class="RktPn">#:blocking?</span> argument.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><table cellspacing="0" cellpadding="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((lib._ffi/unsafe..rkt).__fun))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">_fun</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">fun-option</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-args</span><span class="hspace">&nbsp;</span><span class="RktVar">type-spec</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktVar">type-spec</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVar">maybe-wrapper</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">fun-option</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:abi</span><span class="hspace">&nbsp;</span><span class="RktVar">abi-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:save-errno</span><span class="hspace">&nbsp;</span><span class="RktVar">save-errno-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:keep</span><span class="hspace">&nbsp;</span><span class="RktVar">keep-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:atomic?</span><span class="hspace">&nbsp;</span><span class="RktVar">atomic?-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:async-apply</span><span class="hspace">&nbsp;</span><span class="RktVar">async-apply-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:lock-name</span><span class="hspace">&nbsp;</span><span class="RktVar">lock-name-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:in-original-place?</span><span class="hspace">&nbsp;</span><span class="RktVar">in-original-place?-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:blocking?</span><span class="hspace">&nbsp;</span><span class="RktVar">blocking?-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:retry</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">retry-id</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVar">arg-id</span><span class="hspace">&nbsp;</span><span class="RktVar">init-expr</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-args</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">formals</span><span class="hspace">&nbsp;</span><span class="RktSym">::</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">type-spec</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">type-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktVar">type-expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">type-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">=</span><span class="hspace">&nbsp;</span><span class="RktVar">value-expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktVar">type-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">=</span><span class="hspace">&nbsp;</span><span class="RktVar">value-expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-wrapper</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktVar">output-expr</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Creates a new function type.  The <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span> form is a convenient
syntax for the <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__cprocedure%29%29" class="RktValLink" data-pltdoc="x">_cprocedure</a></span> type constructor. In its simplest
form, only the input <span class="RktVar">type-expr</span>s and the output <span class="RktVar">type-expr</span> are
specified, and each types is a simple expression, which creates a
straightforward function type.</div></p><p>For example,</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="String_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__string%29%29" class="RktValLink" data-pltdoc="x">_string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="hspace">&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span></p></blockquote><p>specifies a function that receives a string and an integer
and returns an integer.</p><p>See <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__cprocedure%29%29" class="RktValLink" data-pltdoc="x">_cprocedure</a></span> for information about the <span class="RktPn">#:abi</span>,
<span class="RktPn">#:save-errno</span>, <span class="RktPn">#:keep</span>, <span class="RktPn">#:atomic?</span>,
<span class="RktPn">#:async-apply</span>, <span class="RktPn">#:in-original-place?</span>, and
<span class="RktPn">#:blocking</span> options.</p><p><div class="SIntrapara">In its full form, the <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span> syntax provides an IDL-like
language that creates a wrapper function around the
primitive foreign function when the type is used for a <a href="#%28tech._callout%29" class="techoutside" data-pltdoc="x"><span class="techinside">callout</span></a>.
These wrappers can implement complex interfaces given simple
specifications:
</div><div class="SIntrapara"><ul><li><p>The full form of each argument <span class="RktVar">type-spec</span> can include
an optional label and an expression. A label <span class="RktVar">id</span><span class="stt"> </span><span class="RktSym">:</span>
makes the argument value accessible to later expressions using
<span class="RktVar">id</span>. A <span class="RktVar">=</span><span class="stt"> </span><span class="RktVar">value-expr</span> expression causes the
wrapper function to calculates the argument for that position
using <span class="RktVar">value-expr</span>, implying that the wrapper does not
expect to be given an argument for that position.</p><p>For example,</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="String_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__string%29%29" class="RktValLink" data-pltdoc="x">_string</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="hspace">&nbsp;</span><span class="RktVar">=</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-length%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">string-length</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span></p></blockquote><p>produces a wrapper that takes a single string argument and
calls a foreign function that takes a string and an integer;
the string&rsquo;s length is provided as the integer argument.</p></li><li><p>If the optional <span class="RktVar">output-expr</span> is specified, or if an
expression is provided for the output type, then the expression
specifies an expression that will be used as a return value for
the function call, replacing the foreign function&rsquo;s result. The
<span class="RktVar">output-expr</span> can use any of the previous labels,
including a label given for the output to access the foreign
function&rsquo;s return value.</p><p>For example,</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="String_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__string%29%29" class="RktValLink" data-pltdoc="x">_string</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">len</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._min%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">min</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktSym">len</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p>produces a wrapper that returns the minimum of the foreign
function&rsquo;s result and the given integer argument.</p></li><li><p>A <span class="RktPn">#:retry</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVar">retry-id</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktVar">arg-id</span><span class="stt"> </span><span class="RktVar">init-expr</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktMeta"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span>
specification binds <span class="RktVar">retry-id</span> for use in an
<span class="RktVar">output-expr</span> for retrying the foreign call (normally in
tail position). The function bound to <span class="RktVar">retry-id</span> accepts
each <span class="RktVar">arg-id</span> as an argument, each <span class="RktVar">arg-id</span> can
be used in <span class="RktVar">=</span><span class="stt"> </span><span class="RktVar">value-expr</span>s, and each <span class="RktVar">init-expr</span>s
provides the initial value for the corresponding
<span class="RktVar">arg-id</span>.</p><p>For example,</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:retry</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">again</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="String_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__string%29%29" class="RktValLink" data-pltdoc="x">_string</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="hspace">&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._and%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">=</span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktSym">ERR_BUSY</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3c%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">&lt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">again</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">count</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">r</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>produces a wrapper that calls the foreign function up to five
times if it continues to produce a number equal to
<span class="RktSym">ERR_BUSY</span>.</p></li><li><p>In rare cases where complete control over the input arguments
is needed, the wrapper&rsquo;s argument list can be specified as
<span class="RktVar">maybe-args</span> with a <span class="RktVar">formals</span> as for
<span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._lambda%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">lambda</a></span> (including keyword arguments and/or a &ldquo;rest&rdquo;
argument). When an argument <span class="RktVar">type-spec</span> includes a label
that matches an binding identifier in <span class="RktVar">formals</span>, then
the identifier is used as the default value for the argument.
All argument <span class="RktVar">type-spec</span>s must include either explicit
<span class="RktVar">=</span><span class="stt"> </span><span class="RktVar">value-expr</span> annotations or an implicit one through a
matching label.</p><p>For example,</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">::</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="String_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__string%29%29" class="RktValLink" data-pltdoc="x">_string</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span></p></blockquote><p>produces a wrapper that receives an integer and a string, but
the foreign function receives the string first.</p></li></ul></div></p><p class="SHistory">&#20462;&#25913;&#20110;package <span class="stt">base</span>&#30340;6.2&#29256;&#26412;&#65306;Added the <span class="RktPn">#:retry</span> option.<br/>&#20462;&#25913;&#20110;6.3&#29256;&#26412;&#65306;Added the <span class="RktPn">#:lock-name</span> option.<br/>&#20462;&#25913;&#20110;6.12.0.2&#29256;&#26412;&#65306;Added the <span class="RktPn">#:blocking?</span> option.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#20989;&#25968;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe..rkt)._function-ptr))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29._function-ptr%29%29" class="RktValDef RktValLink" data-pltdoc="x">function-ptr</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ptr-or-proc</span><span class="hspace">&nbsp;</span><span class="RktVar">fun-type</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="foreign_pointer-funcs.html#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ptr-or-proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._or%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="foreign_pointer-funcs.html#%28def._%28%28quote._~23~25foreign%29._cpointer~3f%29%29" class="RktValLink" data-pltdoc="x">cpointer?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">fun-type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Casts <span class="RktVar">ptr-or-proc</span> to a function pointer of type <span class="RktVar">fun-type</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><a name="(form._((lib._ffi/unsafe..rkt)._-~3e))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="RktStxDef RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A literal used in <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span> forms. (It&rsquo;s unfortunate that this
literal has the same name as <span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span> from
<a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=contracts.html&amp;version=7.0.0.18" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket/contract</span></a>, but it&rsquo;s a different binding.}</div></p><h5 x-source-module="(lib &quot;scribblings/foreign/foreign.scrbl&quot;)" x-source-pkg="racket-doc" x-part-tag="&quot;foreign:custom-types&quot;">3.6.1<tt>&nbsp;</tt><a name="(part._foreign~3acustom-types)"></a>Custom Function Types</h5><p>The behavior of the <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span> type can be customized via
<a name="(tech._custom._function._type)"></a><span style="font-family: 楷体">custom function types</span>, which are pieces of syntax that can
behave as C types and C type constructors, but they can interact with
function calls in several ways that are not possible otherwise.  When
the <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span> form is expanded, it tries to expand each of the
given type expressions, and ones that expand to certain keyword-value
lists interact with the generation of the foreign function wrapper.
This expansion makes it possible to construct a single wrapper
function, avoiding the costs involved in compositions of higher-order
functions.</p><p>Custom function types are macros that expand to a sequence
<span class="RktPn">(</span><span class="RktVar">key:</span><span class="stt"> </span><span class="RktVar">val</span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span>, where each <span class="RktVar">key:</span> is from a short list
of known keys.  Each key interacts with generated wrapper functions in
a different way, which affects how its corresponding argument is
treated:</p><ul><li><p><span class="RktSym">type:</span> specifies the foreign type that should be used, if it is
<span class="RktVal">#f</span> then this argument does not participate in the foreign call.</p></li><li><p><span class="RktSym">expr:</span> specifies an expression to be used for arguments of this
type, removing it from wrapper arguments.</p></li><li><p><span class="RktSym">bind:</span> specifies a name that is bound to the original
argument if it is required later (e.g., <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__box%29%29" class="RktStxLink" data-pltdoc="x">_box</a></span> converts its
associated value to a C pointer, and later needs to refer back to
the original box).</p></li><li><p><span class="RktSym">1st-arg:</span> specifies a name that can be used to refer to
the first argument of the foreign call (good for common cases where
the first argument has a special meaning, e.g., for method calls).</p></li><li><p><span class="RktSym">prev-arg:</span> similar to <span class="RktSym">1st-arg:</span>, but refers to the
previous argument.</p></li><li><p><span class="RktSym">pre:</span> a pre-foreign code chunk that is used to change the
argument&rsquo;s value.</p></li><li><p><span class="RktSym">post:</span> a similar post-foreign code chunk.</p></li><li><p><span class="RktSym">keywords:</span> specifies keyword/value expressions that will
be used with the surrounding <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span> form.  (Note: the
keyword/value sequence follows <span class="RktSym">keywords:</span>, not parenthesized.)</p></li></ul><p>The <span class="RktSym">pre:</span> and <span class="RktSym">post:</span> bindings can be of the form
<span class="RktPn">(</span><span class="RktVar">id</span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._%7E3d%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">=&gt;</a></span><span class="stt"> </span><span class="RktVar">expr</span><span class="RktPn">)</span> to use the existing value.  Note that if the
<span class="RktSym">pre:</span> expression is not <span class="RktPn">(</span><span class="RktVar">id</span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._%7E3d%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">=&gt;</a></span><span class="stt"> </span><span class="RktVar">expr</span><span class="RktPn">)</span>, then it means
that there is no input for this argument to the
<span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span>-generated procedure.  Also note that if a custom type is
used as an output type of a function, then only the <span class="RktSym">post:</span>
code is used.</p><p>Most custom types are meaningful only in a <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span> context, and
will raise a syntax error if used elsewhere.  A few such types can be
used in non-<span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span> contexts: types which use only
<span class="RktSym">type:</span>, <span class="RktSym">pre:</span>, <span class="RktSym">post:</span>, and no others.  Such
custom types can be used outside a <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span> by expanding them
into a usage of <span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._make-ctype%29%29" class="RktValLink" data-pltdoc="x">make-ctype</a></span>, using other keywords makes this
impossible, because it means that the type has specific interaction
with a function call.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._ffi/unsafe..rkt)._define-fun-syntax))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._define-fun-syntax%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-fun-syntax</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktVar">transformer-expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Binds <span class="RktVar">id</span> as a <a href="#%28tech._custom._function._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">custom function type</span></a> as well as a syntax
transformer (i.e, macro). The type is expanded by applying the
procedure produced by <span class="RktVar">transformer-expr</span> to a use of the
<a href="#%28tech._custom._function._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">custom function type</span></a>.</div></p><p>For instance, the following defines a new type that automatically
coerces the input number to an inexact form which is compatible with
the <span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28quote._~23~25foreign%29.__float%29%29" class="RktValLink" data-pltdoc="x">_float</a></span> type.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._define-fun-syntax%29%29" class="RktStxLink" data-pltdoc="x">define-fun-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktSym">_float*</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax-id-rules%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">syntax-id-rules</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">_float*</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">_float*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">type:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28quote._~23~25foreign%29.__float%29%29" class="RktValLink" data-pltdoc="x">_float</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pre:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._%7E3d%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">=&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0.0</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktSym">_float*</span><span class="hspace">&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Other_Atomic_Types.html#%28def._%28%28quote._~23~25foreign%29.__bool%29%29" class="RktValLink" data-pltdoc="x">_bool</a></span><span class="RktPn">)</span></td></tr></table></blockquote><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><a name="(form._((lib._ffi/unsafe..rkt).__~3f))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__~3f%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">_?</a></span></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <a href="#%28tech._custom._function._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">custom function type</span></a> that is a marker for expressions that
should not be sent to the foreign function.  Use this to bind local
values in a computation that is part of an ffi wrapper interface, or
to specify wrapper arguments that are not sent to the foreign function
(e.g., an argument that is used for processing the foreign output).</div></p><p>Examples:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__~3f%29%29" class="RktStxLink" data-pltdoc="x">_?</a></span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">not sent to foreign function</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">init</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__~3f%29%29" class="RktStxLink" data-pltdoc="x">_?</a></span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">init is used for pre-processing</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">boxed</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__box%29%29" class="RktStxLink" data-pltdoc="x">_box</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3d%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._box%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">box</a></span><span class="hspace">&nbsp;</span><span class="RktSym">init</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Other_Atomic_Types.html#%28def._%28%28quote._~23~25foreign%29.__void%29%29" class="RktValLink" data-pltdoc="x">_void</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">offset</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__~3f%29%29" class="RktStxLink" data-pltdoc="x">_?</a></span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">offset is used for post-processing</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktSym">offset</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._ffi/unsafe..rkt).__ptr))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__ptr%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">_ptr</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mode</span><span class="hspace">&nbsp;</span><span class="RktVar">type-expr</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">mode</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktSym">i</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktSym">o</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktSym">io</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Creates a C pointer type, where <span class="RktVar">mode</span> indicates input or
output pointers (or both).  The <span class="RktVar">mode</span> can be one of the
following:</div></p><ul><li><p><span class="RktSym">i</span> &#8212;<wbr></wbr> indicates an <span style="font-family: 楷体">input</span> pointer argument:
the wrapper arranges for the function call to receive a value that
can be used with the <span class="RktSym">type</span> and to send a pointer to this
value to the foreign function.  After the call, the value is
discarded.</p></li><li><p><span class="RktSym">o</span> &#8212;<wbr></wbr> indicates an <span style="font-family: 楷体">output</span> pointer argument:
the foreign function expects a pointer to a place where it will save
some value, and this value is accessible after the call, to be used
by an extra return expression.  If <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__ptr%29%29" class="RktStxLink" data-pltdoc="x">_ptr</a></span> is used in this
mode, then the generated wrapper does not expect an argument since
one will be freshly allocated before the call. The argument is
allocated using <span class="RktPn">(</span><span class="RktSym"><a href="foreign_pointer-funcs.html#%28def._%28%28quote._~23~25foreign%29._malloc%29%29" class="RktValLink" data-pltdoc="x">malloc</a></span><span class="stt"> </span><span class="RktVar">type-expr</span><span class="RktPn">)</span>.</p></li><li><p><span class="RktSym">io</span> &#8212;<wbr></wbr> combines the above into an
<span style="font-family: 楷体">input/output</span> pointer argument: the wrapper gets the Racket
value, allocates and set a pointer using this value, and then
references the value after the call.  The &ldquo;<span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__ptr%29%29" class="RktStxLink" data-pltdoc="x">_ptr</a></span>&rdquo; name can
be confusing here: it means that the foreign function expects a
pointer, but the generated wrapper uses an actual value.  (Note that
if this is used with structs, a struct is created when calling the
function, and a copy of the return value is made too&#8212;<wbr></wbr>which is
inefficient, but ensures that structs are not modified by C code.)</p></li></ul><p>For example, the <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__ptr%29%29" class="RktStxLink" data-pltdoc="x">_ptr</a></span> type can be used in output mode to create a
foreign function wrapper that returns more than a single argument.  The
following type:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__ptr%29%29" class="RktStxLink" data-pltdoc="x">_ptr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">o</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28quote._~23~25foreign%29.__double%29%29" class="RktValLink" data-pltdoc="x">_double</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">values</a></span><span class="hspace">&nbsp;</span><span class="RktSym">d</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>creates a function that calls the foreign function with a fresh
integer pointer, and use the value that is placed there as a second
return value.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._ffi/unsafe..rkt).__box))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__box%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">_box</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <a href="#%28tech._custom._function._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">custom function type</span></a> similar to a <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__ptr%29%29" class="RktStxLink" data-pltdoc="x">_ptr</a></span><span class="stt"> </span><span class="RktSym">io</span><span class="stt"> </span><span class="RktVar">type</span><span class="RktPn">)</span>
argument, where the input is expected to be a box holding an
appropriate value, which is unboxed on entry and modified accordingly
on exit.</div></p><p>Example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__box%29%29" class="RktStxLink" data-pltdoc="x">_box</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Other_Atomic_Types.html#%28def._%28%28quote._~23~25foreign%29.__void%29%29" class="RktValLink" data-pltdoc="x">_void</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">boxed</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__box%29%29" class="RktStxLink" data-pltdoc="x">_box</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3d%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._box%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">box</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">values</a></span><span class="hspace">&nbsp;</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=boxes.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._unbox%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">unbox</a></span><span class="hspace">&nbsp;</span><span class="RktSym">boxed</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._ffi/unsafe..rkt).__list))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__list%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">_list</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mode</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-len</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">mode</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">i</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">o</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">io</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">maybe-len</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">len-expr</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">A <a href="#%28tech._custom._function._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">custom function type</span></a> that is similar to <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__ptr%29%29" class="RktStxLink" data-pltdoc="x">_ptr</a></span>, except
that it is used for converting lists to/from C vectors.  The optional
<span class="RktVar">maybe-len</span> argument is needed for output values where it is used in
the post code, and in the pre code of an output mode to allocate the
block.  (If the length is 0, then NULL is passed in and an empty list is
returned.)  In either case, it can refer to a previous binding for the
length of the list which the C function will most likely require.</div></p><p>For example, the following type corresponds to a function that takes
a vector argument of type <span class="stt">*float</span> (from a Racket list input)
and a length argument of type <span class="stt">int</span> for the vector:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__list%29%29" class="RktStxLink" data-pltdoc="x">_list</a></span><span class="hspace">&nbsp;</span><span class="RktVar">i</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28quote._~23~25foreign%29.__float%29%29" class="RktValLink" data-pltdoc="x">_float</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">this argument is implicitly provided</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3d%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._length%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">length</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vec</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Other_Atomic_Types.html#%28def._%28%28quote._~23~25foreign%29.__void%29%29" class="RktValLink" data-pltdoc="x">_void</a></span><span class="RktPn">)</span></td></tr></table></blockquote><p>In this next example, the type specifies a function that provides
output through a given output vector (represented as a list on the
Racket side) and through a boolean return value. The FFI-bound
function will take an integer argument and
return two values, the vector and the boolean.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">len</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__list%29%29" class="RktStxLink" data-pltdoc="x">_list</a></span><span class="hspace">&nbsp;</span><span class="RktVar">o</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28quote._~23~25foreign%29.__float%29%29" class="RktValLink" data-pltdoc="x">_float</a></span><span class="hspace">&nbsp;</span><span class="RktSym">len</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Other_Atomic_Types.html#%28def._%28%28quote._~23~25foreign%29.__bool%29%29" class="RktValLink" data-pltdoc="x">_bool</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">values</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktSym">res</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._ffi/unsafe..rkt).__vector))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__vector%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">_vector</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">mode</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span><span class="RktVar">maybe-len</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <a href="#%28tech._custom._function._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">custom function type</span></a> like <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__list%29%29" class="RktStxLink" data-pltdoc="x">_list</a></span>, except that it uses
Racket vectors instead of lists.</div></p><p>Examples:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__vector%29%29" class="RktStxLink" data-pltdoc="x">_vector</a></span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28quote._~23~25foreign%29.__float%29%29" class="RktValLink" data-pltdoc="x">_float</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3d%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._length%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">length</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vec</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Other_Atomic_Types.html#%28def._%28%28quote._~23~25foreign%29.__void%29%29" class="RktValLink" data-pltdoc="x">_void</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">len</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__vector%29%29" class="RktStxLink" data-pltdoc="x">_vector</a></span><span class="hspace">&nbsp;</span><span class="RktSym">o</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28quote._~23~25foreign%29.__float%29%29" class="RktValLink" data-pltdoc="x">_float</a></span><span class="hspace">&nbsp;</span><span class="RktSym">len</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Other_Atomic_Types.html#%28def._%28%28quote._~23~25foreign%29.__bool%29%29" class="RktValLink" data-pltdoc="x">_bool</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">values</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktSym">res</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>See <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__list%29%29" class="RktStxLink" data-pltdoc="x">_list</a></span> for more explanation about the examples.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><a name="(form._((lib._ffi/unsafe..rkt).__bytes))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">_bytes</a></span></span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">_bytes</a></span><span class="hspace">&nbsp;</span><span class="RktSym">o</span><span class="hspace">&nbsp;</span><span class="RktVar">len-expr</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxLink" data-pltdoc="x">_bytes</a></span> form by itself corresponds to C&rsquo;s <span class="stt">char*</span>
type; a byte string is passed as <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxLink" data-pltdoc="x">_bytes</a></span> without any
copying. In the current Racket implementation, a Racket byte string is
normally nul terminated implicitly, but a future implementation of
Racket may not include an implicit nul terminator for byte strings.
See also <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%2Fnul-terminated%29%29" class="RktStxLink" data-pltdoc="x">_bytes/nul-terminated</a></span>.</div></p><p>In the current Racket implementation, as <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxLink" data-pltdoc="x">_bytes</a></span> result, a C
non-NULL <span class="stt">char*</span> is wrapped as a Racket byte string without
copying; future Racket implementations may require copying to
represent a C <span class="stt">char*</span> result as a Racket byte string. The C result
must have a nul terminator to determine the Racket byte string&rsquo;s
length.</p><p>A <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxLink" data-pltdoc="x">_bytes</a></span><span class="stt"> </span><span class="RktSym">o</span><span class="stt"> </span><span class="RktVar">len-expr</span><span class="RktPn">)</span> form is a <a href="#%28tech._custom._function._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">custom function type</span></a>.
As an argument, a byte string is allocated with the given length; in
the current Racket implementation, that byte string includes an extra
byte for the nul terminator (but, again, a future Racket
implementation may not behave that way). As a result, <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxLink" data-pltdoc="x">_bytes</a></span><span class="stt"> </span><span class="RktSym">o</span><span class="stt"> </span><span class="RktVar">len-expr</span><span class="RktPn">)</span> wraps a C non-NULL <span class="stt">char*</span> pointer as a byte string of
the given length (but, again, a future Racket implementation may copy
the indicated number of bytes to a fresh byte string).</p><p>As usual, <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxLink" data-pltdoc="x">_bytes</a></span> treats <span class="RktVal">#f</span> as <span class="stt">NULL</span> and vice
versa. As a result type, <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxLink" data-pltdoc="x">_bytes</a></span><span class="stt"> </span><span class="RktSym">o</span><span class="stt"> </span><span class="RktVar">len-expr</span><span class="RktPn">)</span> works only for
non-NULL results.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>&#35821;&#27861;</p></div></div><p class="RForeground"><a name="(form._((lib._ffi/unsafe..rkt).__bytes/nul-terminated))"></a><span title="提供自：ffi/unsafe | 包：base"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%2Fnul-terminated%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">_bytes/nul-terminated</a></span></span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%2Fnul-terminated%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">_bytes/nul-terminated</a></span><span class="hspace">&nbsp;</span><span class="RktSym">o</span><span class="hspace">&nbsp;</span><span class="RktVar">len-expr</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%2Fnul-terminated%29%29" class="RktStxLink" data-pltdoc="x">_bytes/nul-terminated</a></span> type is like <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxLink" data-pltdoc="x">_bytes</a></span>, but
an explicit nul-terminator byte is added to a byte-string argument,
which implies copying. As a result type, a <span class="stt">char*</span> is copied to a
fresh byte string (without an explicit nul terminator).</div></p><p>When <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxLink" data-pltdoc="x">_bytes</a></span><span class="stt"> </span><span class="RktSym">o</span><span class="stt"> </span><span class="RktVar">len-expr</span><span class="RktPn">)</span> is used as an argument type, a byte
string of length <span class="RktVar">len-expr</span> is allocated. Similarly, when
<span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%29%29" class="RktStxLink" data-pltdoc="x">_bytes</a></span><span class="stt"> </span><span class="RktSym">o</span><span class="stt"> </span><span class="RktVar">len-expr</span><span class="RktPn">)</span> is used as a result type, a <span class="stt">char*</span>
result is copied to a fresh byte string of length <span class="RktVar">len-expr</span>.</p><p>As usual, <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%2Fnul-terminated%29%29" class="RktStxLink" data-pltdoc="x">_bytes/nul-terminated</a></span> treats <span class="RktVal">#f</span> as
<span class="stt">NULL</span> and vice versa. As a result type,
<span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__bytes%2Fnul-terminated%29%29" class="RktStxLink" data-pltdoc="x">_bytes/nul-terminated</a></span><span class="stt"> </span><span class="RktSym">o</span><span class="stt"> </span><span class="RktVar">len-expr</span><span class="RktPn">)</span> works only for non-NULL
results.</p><p class="SHistory">&#28155;&#21152;&#20110;package <span class="stt">base</span>&#30340;6.12.0.2&#29256;&#26412;&#12290;</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="Pointer_Types.html" title="后退至&quot;3.5 Pointer Types&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="types.html" title="上至&quot;3 C Types&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="C_Struct_Types.html" title="前进至&quot;3.7 C Struct Types&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>