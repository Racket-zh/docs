<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>6.5&nbsp;Nonstrict Arrays</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Math Library</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="base.html" class="tocviewlink" data-pltdoc="x">Constants and Elementary Functions</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="flonum.html" class="tocviewlink" data-pltdoc="x">Flonums</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="special.html" class="tocviewlink" data-pltdoc="x">Special Functions</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="number-theory.html" class="tocviewlink" data-pltdoc="x">Number Theory</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="bigfloat.html" class="tocviewlink" data-pltdoc="x">Arbitrary-<wbr></wbr>Precision Floating-<wbr></wbr>Point Numbers (<a name="(tech._bigfloat)"></a><span style="font-family: 楷体">Bigfloats</span>)</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="array.html" class="tocviewselflink" data-pltdoc="x">Arrays</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="matrices.html" class="tocviewlink" data-pltdoc="x">Matrices and Linear Algebra</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="stats.html" class="tocviewlink" data-pltdoc="x">Statistics Functions</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="dist.html" class="tocviewlink" data-pltdoc="x">Probability Distributions</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="utils.html" class="tocviewlink" data-pltdoc="x">Stuff That Doesn&rsquo;t Belong Anywhere Else</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>6&nbsp;</td><td><a href="array.html" class="tocviewlink" data-pltdoc="x">Arrays</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">6.1&nbsp;</td><td><a href="array_quick.html" class="tocviewlink" data-pltdoc="x">Quick Start</a></td></tr><tr><td align="right">6.2&nbsp;</td><td><a href="array_defs.html" class="tocviewlink" data-pltdoc="x">Definitions</a></td></tr><tr><td align="right">6.3&nbsp;</td><td><a href="array_broadcasting.html" class="tocviewlink" data-pltdoc="x">Broadcasting</a></td></tr><tr><td align="right">6.4&nbsp;</td><td><a href="array_slicing.html" class="tocviewlink" data-pltdoc="x">Slicing</a></td></tr><tr><td align="right">6.5&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Nonstrict Arrays</a></td></tr><tr><td align="right">6.6&nbsp;</td><td><a href="array_types.html" class="tocviewlink" data-pltdoc="x">Types, Predicates and Accessors</a></td></tr><tr><td align="right">6.7&nbsp;</td><td><a href="array_construct.html" class="tocviewlink" data-pltdoc="x">Construction</a></td></tr><tr><td align="right">6.8&nbsp;</td><td><a href="array_convert.html" class="tocviewlink" data-pltdoc="x">Conversion</a></td></tr><tr><td align="right">6.9&nbsp;</td><td><a href="array_sequences.html" class="tocviewlink" data-pltdoc="x">Comprehensions and Sequences</a></td></tr><tr><td align="right">6.10&nbsp;</td><td><a href="array_pointwise.html" class="tocviewlink" data-pltdoc="x">Pointwise Operations</a></td></tr><tr><td align="right">6.11&nbsp;</td><td><a href="array_indexing.html" class="tocviewlink" data-pltdoc="x">Indexing and Slicing</a></td></tr><tr><td align="right">6.12&nbsp;</td><td><a href="array_transform.html" class="tocviewlink" data-pltdoc="x">Transformations</a></td></tr><tr><td align="right">6.13&nbsp;</td><td><a href="array_fold.html" class="tocviewlink" data-pltdoc="x">Folds, Reductions and Expansions</a></td></tr><tr><td align="right">6.14&nbsp;</td><td><a href="array_other.html" class="tocviewlink" data-pltdoc="x">Other Array Operations</a></td></tr><tr><td align="right">6.15&nbsp;</td><td><a href="array_subtypes.html" class="tocviewlink" data-pltdoc="x">Subtypes</a></td></tr><tr><td align="right">6.16&nbsp;</td><td><a href="array_strict.html" class="tocviewlink" data-pltdoc="x">Strictness</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td>6.5&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Nonstrict Arrays</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">6.5.1&nbsp;</td><td><a href="#%28part._.Caching_.Nonstrict_.Elements%29" class="tocviewlink" data-pltdoc="x">Caching Nonstrict Elements</a></td></tr><tr><td align="right">6.5.2&nbsp;</td><td><a href="#%28part._.Performance_.Considerations%29" class="tocviewlink" data-pltdoc="x">Performance Considerations</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">在本页中：</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">6.5.1<tt>&nbsp;</tt></span><a href="#%28part._.Caching_.Nonstrict_.Elements%29" class="tocsubseclink" data-pltdoc="x">Caching Nonstrict Elements</a></td></tr><tr><td><span class="tocsublinknumber">6.5.2<tt>&nbsp;</tt></span><a href="#%28part._.Performance_.Considerations%29" class="tocsubseclink" data-pltdoc="x">Performance Considerations</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="array_slicing.html" title="后退至&quot;6.4 Slicing&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="array.html" title="上至&quot;6 Arrays&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="array_types.html" title="前进至&quot;6.6 Types, Predicates and Accessors&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div><h4 x-source-module="(lib &quot;math/scribblings/math.scrbl&quot;)" x-source-pkg="math-doc" x-part-tag="&quot;array:nonstrict&quot;">6.5<tt>&nbsp;</tt><a name="(part._array~3anonstrict)"></a>Nonstrict Arrays</h4><p>With few exceptions, by default, the functions exported by <a href="array.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">math/array</span></a> return
<a name="(tech._strict)"></a><span style="font-family: 楷体">strict</span> arrays, which are arrays whose <a href="array_defs.html#%28tech._procedure%29" class="techoutside" data-pltdoc="x"><span class="techinside">procedures</span></a> compute elements by looking them
up in a vector.</p><p><div class="SIntrapara">This conservative default often wastes time and space. In functional code that operates on arrays,
the elements in most intermediate arrays are referred to exactly once, so allocating and filling
storage for them should be unnecessary. For example, consider the following array:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-hellos</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_pointwise.html#%28def._%28%28lib._math%2Farray..rkt%29._array-map%29%29" class="RktValLink" data-pltdoc="x">array-map</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-append%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">string-append</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_pointwise.html#%28def._%28%28lib._math%2Farray..rkt%29._array-map%29%29" class="RktValLink" data-pltdoc="x">array-map</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-append%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">string-append</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_construct.html#%28form._%28%28lib._math%2Farray..rkt%29._array%29%29" class="RktStxLink" data-pltdoc="x">array</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">[</span><span class="RktVal">"Hello "</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hallo "</span><span class="hspace">&nbsp;</span><span class="RktVal">"J&#243; napot "</span><span class="RktVal">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_construct.html#%28form._%28%28lib._math%2Farray..rkt%29._array%29%29" class="RktStxLink" data-pltdoc="x">array</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">[</span><span class="RktVal">"Ada"</span><span class="hspace">&nbsp;</span><span class="RktVal">"Edsger"</span><span class="hspace">&nbsp;</span><span class="RktVal">"John"</span><span class="RktVal">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_construct.html#%28def._%28%28lib._math%2Farray..rkt%29._make-array%29%29" class="RktValLink" data-pltdoc="x">make-array</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"!"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">arr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-hellos</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strict~3f%29%29" class="RktValLink" data-pltdoc="x">array-strict?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">arr</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : Boolean</span></p></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">arr</span></td></tr><tr><td><p><span class="RktOut">- : (Array String)</span></p></td></tr><tr><td><p><span class="RktRes">(array #["Hello Ada!" "Hallo Edsger!" "J&#243; napot John!"])</span></p></td></tr></table></blockquote></div><div class="SIntrapara">By default, the result of the inner <span class="RktSym"><a href="array_pointwise.html#%28def._%28%28lib._math%2Farray..rkt%29._array-map%29%29" class="RktValLink" data-pltdoc="x">array-map</a></span> has storage allocated for it and filled with
strings such as <span class="RktVal">"Hello Ada"</span>, even though its storage will be thrown away at the next garbage
collection cycle.</div></p><p>An additional concern becomes even more important as Racket&rsquo;s support for parallel computation
improves. Allocating storage for intermediate arrays is a synchronization point in long computations,
which divides them into many short computations, making them difficult to parallelize.</p><p><span class="refelem"><span class="refcolumn"><span class="refcontent">* <span style="font-weight: bold">Regular, shape-polymorphic, parallel arrays in Haskell</span>,
 Gabriele Keller, Manuel Chakravarty, Roman Leshchinskiy, Simon Peyton Jones,
 and Ben Lippmeier. ICFP 2010. <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/ndp/RArrays.pdf">(PDF)</a></span></span></span></p><p><div class="SIntrapara">A solution is to construct <a name="(tech._nonstrict)"></a><span style="font-family: 楷体">nonstrict</span> arrays*, which are arrays whose procedures can do more
than simply look up elements. Setting the parameter <span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strictness%29%29" class="RktValLink" data-pltdoc="x">array-strictness</a></span> to <span class="RktVal">#f</span> causes
almost all <a href="array.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">math/array</span></a> functions to return nonstrict arrays:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">arr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=parameters.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._parameterize%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">parameterize</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strictness%29%29" class="RktValLink" data-pltdoc="x">array-strictness</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-hellos</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strict~3f%29%29" class="RktValLink" data-pltdoc="x">array-strict?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">arr</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : Boolean</span></p></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">arr</span></td></tr><tr><td><p><span class="RktOut">- : (Array String)</span></p></td></tr><tr><td><p><span class="RktRes">(array #["Hello Ada!" "Hallo Edsger!" "J&#243; napot John!"])</span></p></td></tr></table></blockquote></div><div class="SIntrapara">In <span class="RktSym">arr</span>, the first element is the <span style="font-family: 楷体">computation</span>
<span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-append%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">string-append</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-append%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">string-append</a></span><span class="stt"> </span><span class="RktVal">"Hello "</span><span class="stt"> </span><span class="RktVal">"Ada"</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">"!"</span><span class="RktPn">)</span>, not the value <span class="RktVal">"Hello Ada!"</span>.
The value <span class="RktVal">"Hello Ada!"</span> is recomputed every time the first element is referred to.</div></p><p>To use nonstrict arrays effectively, think of every array as if it were the array&rsquo;s
<a href="array_defs.html#%28tech._procedure%29" class="techoutside" data-pltdoc="x"><span class="techinside">procedure</span></a> itself. In other words,</p><blockquote><p><span style="font-weight: bold">An <span style="font-family: 楷体">array</span> is just a function with a finite,
   rectangular domain.</span></p></blockquote><p>Some arrays are mutable, some are lazy, some are strict, some are sparse, and most
do not even allocate contiguous space to store their elements. All are functions that can be
applied to indexes to retrieve elements.</p><p>The two most common kinds of operations, mapping over and transforming arrays, are compositions.
Mapping <span class="RktSym">f</span> over array <span class="RktSym">arr</span> is nothing more than composing <span class="RktSym">f</span> with
<span class="RktSym">arr</span>&rsquo;s procedure.
Transforming <span class="RktSym">arr</span> using <span class="RktSym">g</span>, a function from new indexes to old indexes, is nothing
more than composing <span class="RktSym">arr</span>&rsquo;s procedure with <span class="RktSym">g</span>.</p><h5 x-source-module="(lib &quot;math/scribblings/math.scrbl&quot;)" x-source-pkg="math-doc" x-part-tag="&quot;Caching_Nonstrict_Elements&quot;">6.5.1<tt>&nbsp;</tt><a name="(part._.Caching_.Nonstrict_.Elements)"></a>Caching Nonstrict Elements</h5><p><span style="font-weight: bold">Nonstrict arrays are not lazy.</span> Very few nonstrict arrays cache computed elements,
but like functions, recompute them every time they are referred to. Unlike functions, they can have
every element computed and cached at once, by making them <a href="#%28tech._strict%29" class="techoutside" data-pltdoc="x"><span class="techinside">strict</span></a>.</p><p><div class="SIntrapara">To compute and store an array&rsquo;s elements, use <span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strict%21%29%29" class="RktValLink" data-pltdoc="x">array-strict!</a></span> or <span class="RktSym"><a href="array_strict.html#%28form._%28%28lib._math%2Farray..rkt%29._array-strict%29%29" class="RktStxLink" data-pltdoc="x">array-strict</a></span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strict~3f%29%29" class="RktValLink" data-pltdoc="x">array-strict?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">arr</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : Boolean</span></p></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strict%21%29%29" class="RktValLink" data-pltdoc="x">array-strict!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">arr</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strict~3f%29%29" class="RktValLink" data-pltdoc="x">array-strict?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">arr</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : Boolean</span></p></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="array_strict.html#%28form._%28%28lib._math%2Farray..rkt%29._array-strict%29%29" class="RktStxLink" data-pltdoc="x">array-strict</a></span><span class="hspace">&nbsp;</span><span class="RktSym">arr</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : (Array String)</span></p></td></tr><tr><td><p><span class="RktRes">(array #["Hello Ada!" "Hallo Edsger!" "J&#243; napot John!"])</span></p></td></tr></table></blockquote></div><div class="SIntrapara">If the array is already strict, as in the last example above, <span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strict%21%29%29" class="RktValLink" data-pltdoc="x">array-strict!</a></span> and
<span class="RktSym"><a href="array_strict.html#%28form._%28%28lib._math%2Farray..rkt%29._array-strict%29%29" class="RktStxLink" data-pltdoc="x">array-strict</a></span> do nothing.</div></p><p>To make a strict <span style="font-family: 楷体">copy</span> of an array without making the original array strict, use
<span class="RktSym"><a href="array_construct.html#%28def._%28%28lib._math%2Farray..rkt%29._array-~3emutable-array%29%29" class="RktValLink" data-pltdoc="x">array-&gt;mutable-array</a></span>.</p><h5 x-source-module="(lib &quot;math/scribblings/math.scrbl&quot;)" x-source-pkg="math-doc" x-part-tag="&quot;Performance_Considerations&quot;">6.5.2<tt>&nbsp;</tt><a name="(part._.Performance_.Considerations)"></a>Performance Considerations</h5><p>One downside to nonstrict arrays is that it is more difficult to reason about the performance of
operations on them. Another is that the user must decide which arrays to make strict. Fortunately,
there is a simple rule of thumb:</p><blockquote><p><span style="font-weight: bold">Make arrays strict when you must refer to most of their elements
more than once or twice.</span></p></blockquote><p><div class="SIntrapara">Having to name an array is a good indicator that it should be strict. In the
following example, which computes <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._expt%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">expt</a></span><span class="stt"> </span><span class="RktSym">x</span><span class="stt"> </span><span class="RktSym">x</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._expt%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">expt</a></span><span class="stt"> </span><span class="RktSym">x</span><span class="stt"> </span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span> for <span class="RktSym">x</span> from <span class="RktVal">0</span>
to <span class="RktVal">2499</span>, each element in <span class="RktSym">xrr</span> is computed twice whenever its corresponding element
in <span class="RktSym">res</span> is referred to:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">xrr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_pointwise.html#%28def._%28%28lib._math%2Farray..rkt%29._array-map%29%29" class="RktValLink" data-pltdoc="x">array-map</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._expt%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">expt</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_construct.html#%28def._%28%28lib._math%2Farray..rkt%29._index-array%29%29" class="RktValLink" data-pltdoc="x">index-array</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">50</span><span class="hspace">&nbsp;</span><span class="RktVal">50</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_construct.html#%28def._%28%28lib._math%2Farray..rkt%29._index-array%29%29" class="RktValLink" data-pltdoc="x">index-array</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">50</span><span class="hspace">&nbsp;</span><span class="RktVal">50</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_pointwise.html#%28form._%28%28lib._math%2Farray..rkt%29._array%2B%29%29" class="RktStxLink" data-pltdoc="x">array+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">xrr</span><span class="hspace">&nbsp;</span><span class="RktSym">xrr</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Having to name <span class="RktSym">xrr</span> means we should make it strict:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">xrr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_strict.html#%28form._%28%28lib._math%2Farray..rkt%29._array-strict%29%29" class="RktStxLink" data-pltdoc="x">array-strict</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_pointwise.html#%28def._%28%28lib._math%2Farray..rkt%29._array-map%29%29" class="RktValLink" data-pltdoc="x">array-map</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._expt%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">expt</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_construct.html#%28def._%28%28lib._math%2Farray..rkt%29._index-array%29%29" class="RktValLink" data-pltdoc="x">index-array</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">50</span><span class="hspace">&nbsp;</span><span class="RktVal">50</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_construct.html#%28def._%28%28lib._math%2Farray..rkt%29._index-array%29%29" class="RktValLink" data-pltdoc="x">index-array</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">50</span><span class="hspace">&nbsp;</span><span class="RktVal">50</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_pointwise.html#%28form._%28%28lib._math%2Farray..rkt%29._array%2B%29%29" class="RktStxLink" data-pltdoc="x">array+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">xrr</span><span class="hspace">&nbsp;</span><span class="RktSym">xrr</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Doing so halves the time it takes to compute <span class="RktSym">res</span>&rsquo;s elements.</div></p><p>When returning an array from a function, return nonstrict arrays as they are, to allow the caller to
decide whether the result should be strict.</p><p><div class="SIntrapara">When writing library functions that may be called with either <span class="RktPn">(</span><span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strictness%29%29" class="RktValLink" data-pltdoc="x">array-strictness</a></span><span class="stt"> </span><span class="RktVal">#t</span><span class="RktPn">)</span> or
<span class="RktPn">(</span><span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strictness%29%29" class="RktValLink" data-pltdoc="x">array-strictness</a></span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span>, operate on nonstrict arrays and wrap the result with
<span class="RktSym"><a href="array_strict.html#%28form._%28%28lib._math%2Farray..rkt%29._array-default-strict%29%29" class="RktStxLink" data-pltdoc="x">array-default-strict</a></span> to return what the user is expecting.
For example, if <span class="RktSym">make-hellos</span> is a library function, it should be written as
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-hellos</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_strict.html#%28form._%28%28lib._math%2Farray..rkt%29._array-default-strict%29%29" class="RktStxLink" data-pltdoc="x">array-default-strict</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=parameters.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fmore-scheme..rkt%2529._parameterize%2529%2529&amp;version=7.0.0.18" class="RktStxLink Sq" data-pltdoc="x">parameterize</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-strictness%29%29" class="RktValLink" data-pltdoc="x">array-strictness</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_pointwise.html#%28def._%28%28lib._math%2Farray..rkt%29._array-map%29%29" class="RktValLink" data-pltdoc="x">array-map</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-append%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">string-append</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_pointwise.html#%28def._%28%28lib._math%2Farray..rkt%29._array-map%29%29" class="RktValLink" data-pltdoc="x">array-map</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-append%2529%2529&amp;version=7.0.0.18" class="RktValLink Sq" data-pltdoc="x">string-append</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_construct.html#%28form._%28%28lib._math%2Farray..rkt%29._array%29%29" class="RktStxLink" data-pltdoc="x">array</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">[</span><span class="RktVal">"Hello "</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hallo "</span><span class="hspace">&nbsp;</span><span class="RktVal">"J&#243; napot "</span><span class="RktVal">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_construct.html#%28form._%28%28lib._math%2Farray..rkt%29._array%29%29" class="RktStxLink" data-pltdoc="x">array</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">[</span><span class="RktVal">"Ada"</span><span class="hspace">&nbsp;</span><span class="RktVal">"Edsger"</span><span class="hspace">&nbsp;</span><span class="RktVal">"John"</span><span class="RktVal">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="array_construct.html#%28def._%28%28lib._math%2Farray..rkt%29._make-array%29%29" class="RktValLink" data-pltdoc="x">make-array</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"!"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>If you cannot determine whether to make arrays strict, or are using arrays for so-called
&ldquo;dynamic programming,&rdquo; you can make them lazy using <span class="RktSym"><a href="array_strict.html#%28def._%28%28lib._math%2Farray..rkt%29._array-lazy%29%29" class="RktValLink" data-pltdoc="x">array-lazy</a></span>.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="…搜索手册…" title="输入搜索字符串以搜索手册" onkeypress="return DoSearchKey(event, this, &quot;7.0.0.18&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;…搜索手册…&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;…搜索手册…&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="上至文档的顶层" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.0.0.18&quot;);">&#39030;&#23618;</a></span><span class="navright">&nbsp;&nbsp;<a href="array_slicing.html" title="后退至&quot;6.4 Slicing&quot;" data-pltdoc="x">&larr; &#21069;&#19968;&#39029;</a>&nbsp;&nbsp;<a href="array.html" title="上至&quot;6 Arrays&quot;" data-pltdoc="x">&#19978;&#19968;&#23618;</a>&nbsp;&nbsp;<a href="array_types.html" title="前进至&quot;6.6 Types, Predicates and Accessors&quot;" data-pltdoc="x">&#21518;&#19968;&#39029; &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>